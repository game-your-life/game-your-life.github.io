(this["webpackJsonpgame-your-life"]=this["webpackJsonpgame-your-life"]||[]).push([[0],{190:function(e){e.exports=JSON.parse('{"UserPoolId":"eu-central-1_cn8jgdFjZ","ClientId":"43ktspdetcnstl7gh7u612j8ga"}')},20:function(e){e.exports=JSON.parse('{"url":"https://54vyto2bm4.execute-api.eu-central-1.amazonaws.com/prod"}')},207:function(e,t,s){},208:function(e,t,s){},214:function(e,t){},216:function(e,t){},227:function(e,t){},229:function(e,t){},256:function(e,t){},258:function(e,t){},259:function(e,t){},264:function(e,t){},266:function(e,t){},285:function(e,t){},297:function(e,t){},300:function(e,t){},321:function(e,t,s){"use strict";s.r(t);var n=s(0),a=s(1),r=s.n(a),i=s(44),c=s.n(i),o=(s(207),s(22)),l=s(133),u=s(40),h=s(4),b=s(5),d=s(8),j=s(7),m=(s(208),s(23)),p=s(28),g=s(196),O=s(347),f=s(345),k=s(342),x=s(348),v=s(349),_=s(340),y=s(90),S=s(343),w=s(330),C=s(70),I=s(190),z=new C.d(I),R=function(){return!!z.getCurrentUser()},B=function(){var e=z.getCurrentUser();return e?(console.log(e),e.username):""},F=function(e){var t=z.getCurrentUser();if(!t)return!1;t.getSession((function(s,n){if(s)console.log(s);else{console.log("Session valid?",n.isValid()),console.log(n);var a=n.getIdToken().getJwtToken();e(a,t.username)}}))},E=s(20),L=s(326),U=s(344),A=s(19),T=s(351),M=s(327),P=s(352),N=s(350),D=s(9),W=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).changeEmail=n.changeEmail.bind(Object(A.a)(n)),n.changePassword=n.changePassword.bind(Object(A.a)(n)),n.handleSigninSubmit=n.handleSigninSubmit.bind(Object(A.a)(n)),n.state={email:"",password:"",loading:!1,message:null},n}return Object(b.a)(s,[{key:"changeEmail",value:function(e){this.setState({email:e.target.value})}},{key:"changePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleSigninSubmit",value:function(e){var t=this;e.preventDefault(),this.setState({loading:!0}),console.log("Entered:",this.state),function(e,t,s){var n=e.replace("@","-at-"),a={Username:n,Password:t},r=new C.a(a),i={Username:n,Pool:z};new C.b(i).authenticateUser(r,{onSuccess:function(e){console.log("access token + "+e.getAccessToken().getJwtToken()),s(null,e)},onFailure:function(e){s(e)}})}(this.state.email,this.state.password,(function(e,s){if(e){var a=Object(n.jsx)(v.a,{bsStyle:"warning",children:e.message});return console.log(e),void t.setState({loading:!1,message:a})}console.log(s),t.setState({loading:!1,message:null}),t.props.onSigninSuccess()}))}},{key:"render",value:function(){return Object(n.jsxs)(n.Fragment,{children:[R()?Object(n.jsx)(m.c,{to:"/"}):Object(n.jsx)(n.Fragment,{}),Object(n.jsxs)(T.a,{children:[Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Home"})})}),Object(n.jsx)(D.LinkContainer,{to:"/sign-in",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Sign in"})})})]}),Object(n.jsxs)("form",{onSubmit:this.handleSigninSubmit,children:[Object(n.jsxs)(M.a,{controlId:"email",children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(L.a,{children:"Email"})}),Object(n.jsx)(N.a,{autoFocus:!0,type:"email",value:this.state.email,onChange:this.changeEmail})]}),Object(n.jsxs)(M.a,{controlId:"password",children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(L.a,{children:"Password"})}),Object(n.jsx)(N.a,{value:this.state.password,onChange:this.changePassword,type:"password"})]}),Object(n.jsx)(y.a,{block:!0,disabled:this.state.loading,type:"submit",children:Object(n.jsx)(L.a,{children:"Sign in"})})]})]})}}]),s}(a.Component),V=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).changeEmail=n.changeEmail.bind(Object(A.a)(n)),n.changePassword=n.changePassword.bind(Object(A.a)(n)),n.changeVerifyCode=n.changeVerifyCode.bind(Object(A.a)(n)),n.handleSignupSubmit=n.handleSignupSubmit.bind(Object(A.a)(n)),n.handleVerifySubmit=n.handleVerifySubmit.bind(Object(A.a)(n)),n.state={email:"",password:"",verifyCode:"",showVerification:!1,verified:!1},n}return Object(b.a)(s,[{key:"changeEmail",value:function(e){this.setState({email:e.target.value})}},{key:"changePassword",value:function(e){this.setState({password:e.target.value})}},{key:"changeVerifyCode",value:function(e){this.setState({verifyCode:e.target.value})}},{key:"handleSignupSubmit",value:function(e){var t=this,s=this.state,n=s.email,a=s.password;e.preventDefault(),console.log("Entered:",this.state),function(e,t,s){var n=[new C.c({Name:"email",Value:e})],a=e.replace("@","-at-");z.signUp(a,t,n,null,s)}(n,a,(function(e,s){e?console.log(e):(console.log(s.user),t.setState({showVerification:!0}))}))}},{key:"handleVerifySubmit",value:function(e){var t=this;e.preventDefault(),function(e,t,s){var n={Username:e.replace("@","-at-"),Pool:z};new C.b(n).confirmRegistration(t,!0,s)}(this.state.email,this.state.verifyCode,(function(e,s){e?console.log(e):(t.setState({verified:!0}),alert(s))}))}},{key:"validateForm",value:function(){return this.state.email.length>0&&this.state.password.length>=6}},{key:"render",value:function(){return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Home"})})}),Object(n.jsx)(D.LinkContainer,{to:"/sign-in",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Sign in"})})}),Object(n.jsx)(D.LinkContainer,{to:"/sign-up",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Sign up"})})})]}),this.state.showVerification?Object(n.jsxs)("form",{onSubmit:this.handleVerifySubmit,children:[Object(n.jsxs)(M.a,{controlId:"code",children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(L.a,{children:"Verification Code"})}),Object(n.jsx)(N.a,{value:this.state.verifyCode,onChange:this.changeVerifyCode})]}),Object(n.jsx)(y.a,{block:!0,disabled:!this.validateForm(),type:"submit",children:Object(n.jsx)(L.a,{children:"Verify"})})]}):Object(n.jsxs)("form",{onSubmit:this.handleSignupSubmit,children:[Object(n.jsxs)(M.a,{controlId:"email",children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(L.a,{children:"Email"})}),Object(n.jsx)(N.a,{autoFocus:!0,type:"email",value:this.state.email,onChange:this.changeEmail})]}),Object(n.jsxs)(M.a,{controlId:"password",children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(L.a,{children:"New Password"})}),Object(n.jsx)(N.a,{value:this.state.password,onChange:this.changePassword,type:"password"})]}),Object(n.jsx)(y.a,{block:!0,disabled:!this.validateForm(),type:"submit",children:Object(n.jsx)(L.a,{children:"Sign up"})})]}),this.state.verified?Object(n.jsx)(p.Link,{to:"/sign-in",children:" Go to Log-in Page "}):Object(n.jsx)(n.Fragment,{})]})}}]),s}(r.a.Component),J=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={},R()&&(z.getCurrentUser().signOut(),n.props.onSignout()),n}return Object(b.a)(s,[{key:"render",value:function(){return Object(n.jsx)(m.c,{to:"/"})}}]),s}(r.a.Component),K=s(328),q=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){return Object(n.jsx)(D.LinkContainer,{to:this.props.link,children:Object(n.jsx)(y.a,{variant:"primary",size:"lg",block:!0,children:this.props.value})})}}]),s}(r.a.Component),G=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props.t;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Home"})})}),Object(n.jsx)(D.LinkContainer,{to:"/introduction",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Introduction"})})})]}),Object(n.jsxs)(K.a,{children:[Object(n.jsxs)(L.a,{i18nKey:"introduction.main",children:[Object(n.jsx)("p",{children:" Game your life is an online score based reward system designed to avoid nuclear escalation levels in parenting. "}),Object(n.jsx)("p",{children:" Parents always want the best for their children, but they don't see this. The idea is that an always visible score can serve as motivation factor by itself and it can be used to give a glimpse into future wellbeeing."}),Object(n.jsx)("p",{children:" Both the reward / penalty points and their translation into tangible effects on immediate quality of life are negotiated. "}),Object(n.jsx)("p",{children:" The game includes a built-in score scaling mechanism with the following properties "})]}),Object(n.jsxs)("ul",{children:[Object(n.jsx)("li",{children:Object(n.jsx)(L.a,{i18nKey:"introduction.bullet1",children:"Rewards / penalties always change the score, but the magnitude depends on other factors"})}),Object(n.jsx)("li",{children:Object(n.jsx)(L.a,{i18nKey:"introduction.bullet2",children:"The maximum score penalty reachable on a single day should be recoverable over 3 days normal behavior"})}),Object(n.jsx)("li",{children:Object(n.jsx)(L.a,{i18nKey:"introduction.bullet3",children:"Three days of maximum score penalty per day in a row should be recoverable over 2 weeks of normal behavior"})}),Object(n.jsx)("li",{children:Object(n.jsx)(L.a,{i18nKey:"introduction.bullet4",children:"An escalation and nuclear escalation level is pointed out visually and magnifies scores"})}),Object(n.jsx)("li",{children:Object(n.jsx)(L.a,{i18nKey:"introduction.bullet5",children:"With normal behavior, scores converge towards 10000 with anything above being good behavior and below being unsatisfactory behavior"})})]}),Object(n.jsx)(v.a,{variant:"warning",children:Object(n.jsx)(L.a,{i18nKey:"introduction.warning",children:"Please be aware that your family member might outsmart your rules. Take it as a game and improve them in the next negotiation cycle."})}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(q,{value:e("Privacy Notice"),link:"/privacy"}),Object(n.jsx)(q,{value:e("Sign in"),link:"/sign-in"}),Object(n.jsx)(q,{value:e("Sign up"),link:"/sign-up"})]})]})]})}}]),s}(r.a.Component),H=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Home"})})}),Object(n.jsx)(D.LinkContainer,{to:"/introduction",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Introduction"})})}),Object(n.jsx)(D.LinkContainer,{to:"/privacy",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Privacy"})})})]}),Object(n.jsxs)(K.a,{children:[Object(n.jsxs)(L.a,{i18nKey:"privacy.main",children:[Object(n.jsx)("p",{children:" This web application uses cookies that are functionally required. "}),Object(n.jsx)("p",{children:" It collects data entered by the user of the application. The data is used to make the application work and to improve its development."})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)(L.a,{i18nKey:"privacy.github"})," ",Object(n.jsx)("a",{href:"https://docs.github.com/en/github/site-policy/github-privacy-statement",children:"https://docs.github.com/en/github/site-policy/github-privacy-statement"})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)(L.a,{i18nKey:"privacy.aws"})," ",Object(n.jsx)("a",{href:"https://aws.amazon.com/privacy/",children:"https://aws.amazon.com/privacy/"})]}),Object(n.jsx)("p",{children:Object(n.jsx)(L.a,{i18nKey:"privacy.contact"})})]})]})}}]),s}(r.a.Component),Y=s(329),Z=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props,t=e.t,s=e.score,a=e.member,r=e.role;return Object(n.jsxs)(n.Fragment,{children:["myself"===a?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("h5",{children:Object(n.jsx)(L.a,{children:"You are improving your own life"})}),Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"Your score is"}),":"]})]}):"I"!==a?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"You are connected to"})," ",a.replace("-at-","@")]}),Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"The score is"}),":"]})]}):Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"Your score is"}),":"]}),Object(n.jsx)(g.a,{children:Object(n.jsx)(Y.a,{className:"justify-content-md-center",children:Object(n.jsx)("h1",{children:s})})}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(q,{value:t("Negotiate rewards / penalties"),link:"/negotiate_score/"+a+"/"}),Object(n.jsx)(q,{value:t("Negotiate real world effects"),link:"/negotiate_real/"+a+"/"}),Object(n.jsx)(q,{value:t("Update score"),link:"/update_score/"+a+"/"}),Object(n.jsx)(q,{value:t("Score detail"),link:"/score_detail/"+a+"/"}),"myself"===a&&"solo"===r?Object(n.jsx)(q,{value:t("Manage Others"),link:"/family/"}):"I"===a?Object(n.jsx)(q,{value:t("Manage Myself"),link:"/game/myself/"}):Object(n.jsx)(n.Fragment,{})]})]})}}]),s}(r.a.Component),Q=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;Object(h.a)(this,s),n=t.call(this,e);var a="I"===e.member?"I":"myself",r=n.props.scores[a];return n.state={score_member:a,score:r.score,message:r.message},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to score change"),this.props.scores[this.state.score_member].subscribe_change(this,(function(t){return e.onChange(t)})),this.onChange()}},{key:"onChange",value:function(){var e=this.props.scores[this.state.score_member];this.setState({score:e.score,message:e.message}),console.log("Updated score: ",this.state.score,this.state.message)}},{key:"refresh",value:function(){var e=this;this.props.scores[this.state.score_member].getScore((function(){}),(function(){return e.onChange()}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.connectedTo;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(T.a,{children:Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Home"})})})}),Object(n.jsx)(K.a,{children:""!==a?Object(n.jsxs)(n.Fragment,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),"loading"===this.state.state?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D.Spinner,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}),Object(n.jsx)(y.a,{size:"sm",onClick:function(){return e.refresh()},children:Object(n.jsx)(w.a,{})})]}):Object(n.jsx)(Z,{t:s,score:this.state.score,member:"I",role:"member"})]}):Object(n.jsx)(Z,{t:s,score:this.state.score,member:"myself",role:"solo"})})]})}}]),s}(r.a.Component),X=s(331),$=s(333),ee=s(332),te=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;Object(h.a)(this,s),(n=t.call(this,e)).changeMemberEmail=n.changeMemberEmail.bind(Object(A.a)(n));var a=n.props.familyMembers;return n.state={message:"",members:a.members,newMemberEmail:""},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to baskets loaded"),this.props.familyMembers.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.familyMembers)}},{key:"onLoaded",value:function(e){this.setState({members:e.members,message:e.message}),console.log("Updated family members: ",this.state.members)}},{key:"refresh",value:function(){this.props.familyMembers.getMembers()}},{key:"handleAddMember",value:function(){var e=this,t=this.props.familyMembers;t.addMember(this.state.newMemberEmail,(function(){e.setState({newMemberEmail:"",members:t.members,message:t.message})}),(function(){e.setState({members:t.members,message:t.message})})),this.setState({members:t.members,message:t.message})}},{key:"handleRemoveMember",value:function(e){console.log("TODO: remove: "+e.member_uid)}},{key:"changeMemberEmail",value:function(e){this.setState({newMemberEmail:e.target.value})}},{key:"validateMemberEmail",value:function(){return this.state.newMemberEmail.length>0}},{key:"render",value:function(){var e=this,t=this.props.t;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Home"})})}),Object(n.jsx)(D.LinkContainer,{to:"/family",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Manage Family"})})})]}),Object(n.jsxs)(K.a,{children:[Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"Members associated with your family"}),":"]}),Object(n.jsxs)(X.a,{striped:!0,bordered:!0,hover:!0,size:"sm",responsive:"sm",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"member email"})}),Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"status"})}),Object(n.jsx)("th",{children:Object(n.jsx)(y.a,{size:"sm",onClick:function(){return e.refresh()},children:Object(n.jsx)(w.a,{})})})]})}),Object(n.jsx)("tbody",{children:this.state.members.map((function(t){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:Object(n.jsx)(p.Link,{to:"/game/"+t.member_uid+"/",children:t.member_uid.replace("-at-","@")})}),Object(n.jsx)("td",{children:Object(n.jsx)(L.a,{children:t.status})}),Object(n.jsx)("td",{children:Object(n.jsx)(y.a,{size:"sm",variant:"light",onClick:function(){return e.handleRemoveMember(t)},children:Object(n.jsx)(ee.a,{})})})]})}))})]}),Object(n.jsxs)($.a,{className:"mb-3",children:[Object(n.jsx)(N.a,{placeholder:t("New family member email"),"aria-label":"New family member email","aria-describedby":"basic-addon2",value:this.state.newMemberEmail,onChange:this.changeMemberEmail}),Object(n.jsx)($.a.Append,{children:Object(n.jsx)(y.a,{variant:"outline-secondary",disabled:!this.validateMemberEmail(),type:"submit",onClick:function(){return e.handleAddMember()},children:Object(n.jsx)(L.a,{children:"Add"})})})]})]})]})}}]),s}(r.a.Component),se=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props,t=e.member,s=e.active;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Home"})})}),"I"===t?Object(n.jsx)(n.Fragment,{}):"myself"===t?Object(n.jsx)(D.LinkContainer,{to:"/game/"+t+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Manage Myself"})})}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D.LinkContainer,{to:"/family",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Manage Family"})})}),Object(n.jsx)(D.LinkContainer,{to:"/game/"+t+"/",active:s,children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Game of life"})})})]})]})}}]),s}(r.a.Component),ne=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={score:e.score.score,message:e.score.message},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to score change"),this.props.score.subscribe_change(this,(function(t){return e.onChange(t)})),this.onChange()}},{key:"onChange",value:function(){var e=this.props.score;this.setState({score:e.score,message:e.message}),console.log("Updated score: ",this.state.score,this.state.message)}},{key:"refresh",value:function(){var e=this;this.props.score.getScore((function(){}),(function(){return e.onChange()}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(T.a,{children:Object(n.jsx)(se,{t:s,member:a,active:!0})}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),"loading"===this.state.state?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D.Spinner,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}),Object(n.jsx)(y.a,{size:"sm",onClick:function(){return e.refresh()},children:Object(n.jsx)(w.a,{})})]}):Object(n.jsx)(Z,{t:s,score:this.state.score,member:a,role:"parent"})]})]})}}]),s}(r.a.Component),ae=s(334),re=s(335),ie=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"handleAccept",value:function(){this.newStatus("accepted")}},{key:"handleReject",value:function(){this.newStatus("rejected")}},{key:"newStatus",value:function(e){var t=this;console.log("New Status: ",e,this.props.connectedTo),F((function(s,n){return fetch(E.url+"/familymember/status",{method:"PUT",mode:"cors",headers:{Authorization:s,"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({parent_uid:t.props.connectedTo,status:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(s){t.props.onStatusChange(e)})).catch((function(e){console.log(e),t.props.onStatusChange(null)}))}))}},{key:"render",value:function(){var e=this,t=this.props.connectedTo;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(T.a,{children:Object(n.jsx)(D.LinkContainer,{to:"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Important Request"})})})}),Object(n.jsxs)(K.a,{children:[Object(n.jsx)(L.a,{children:"You were asked to join a family setting with"})," ",t,Object(n.jsxs)(ae.a,{children:[Object(n.jsx)(re.a,{className:"mr-2",children:Object(n.jsx)(y.a,{onClick:function(){return e.handleAccept()},children:Object(n.jsx)(L.a,{children:"Accept"})})}),Object(n.jsx)(re.a,{children:Object(n.jsx)(y.a,{onClick:function(){return e.handleReject()},children:Object(n.jsx)(L.a,{children:"Reject"})})})]})]})]})}}]),s}(r.a.Component),ce=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"handleAccept",value:function(){this.newStatus("deleted")}},{key:"handleReject",value:function(){this.newStatus("accepted")}},{key:"newStatus",value:function(e){var t=this;console.log("New Status: ",e,this.props.connectedTo),F((function(s,n){return fetch(E.url+"/familymember/status",{method:"PUT",mode:"cors",headers:{Authorization:s,"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({parent_uid:t.props.connectedTo,status:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(s){t.props.onStatusChange(e)})).catch((function(e){console.log(e),t.props.onStatusChange(null)}))}))}},{key:"render",value:function(){var e=this,t=this.props.connectedTo;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(T.a,{children:Object(n.jsx)(D.LinkContainer,{to:"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Important Request"})})})}),Object(n.jsxs)(K.a,{children:[Object(n.jsx)(v.a,{children:Object(n.jsx)(L.a,{children:"You will lose all settings / results regarding this family setting when Accepting!"})}),Object(n.jsx)(L.a,{children:"You were asked to terminate a family setting with"})," ",t,Object(n.jsxs)(ae.a,{children:[Object(n.jsx)(re.a,{className:"mr-2",children:Object(n.jsx)(y.a,{onClick:function(){return e.handleAccept()},children:Object(n.jsx)(L.a,{children:"Accept"})})}),Object(n.jsx)(re.a,{children:Object(n.jsx)(y.a,{onClick:function(){return e.handleReject()},children:Object(n.jsx)(L.a,{children:"Reject"})})})]})]})]})}}]),s}(r.a.Component),oe=s(337),le=s(13),ue=s.n(le);var he={used:[],parent:[{id:ue()(),text:"Completing all homework in a week without having to be pushed",operator:null,cmp:null,points:15},{id:ue()(),text:"Free will learning time",operator:">=",cmp:"1h",points:3},{id:ue()(),text:"Major accidental damage",operator:null,cmp:null,points:-30},{id:ue()(),text:"Intentional damage",operator:">=",cmp:"1000 EUR",points:-100}],self:[{id:ue()(),text:"Cooked a healthy meal",operator:null,cmp:null,points:3},{id:ue()(),text:"Cleaned up House",operator:">=",cmp:"1h",points:15},{id:ue()(),text:"Physical exercise",operator:">=",cmp:"1h",points:5},{id:ue()(),text:"Dirty dishes overnight",operator:null,cmp:null,points:-3}]},be=[{text:"Some rule",operator:null,cmp:null,sign:"yields",points:"points (<10 for small things)"},{text:"Some rule",operator:null,cmp:null,sign:"withdraws",points:"points (<10 for small things)"},{text:"Some quantity",operator:">=",cmp:"number",sign:"yields",points:"points (<10 for small things)"},{text:"Some quantity",operator:">=",cmp:"number",sign:"withdraws",points:"points (<10 for small things)"},{text:"Some quantity",operator:"<=",cmp:"number",sign:"yields",points:"points (<10 for small things)"},{text:"Some quantity",operator:"<=",cmp:"number",sign:"withdraws",points:"points (<10 for small things)"}],de=s(336),je=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;Object(h.a)(this,s),(n=t.call(this,e)).changeText=n.changeText.bind(Object(A.a)(n)),n.changeCmp=n.changeCmp.bind(Object(A.a)(n)),n.changePoints=n.changePoints.bind(Object(A.a)(n));var a=n.props,r=a.t,i=a.create_template;return n.state={placeholer_text:r(i.text),placeholer_cmp:r(i.cmp),placeholer_sign:r(i.sign),placeholer_points:r(i.points),cur_text:"",cur_cmp:"",cur_points:""},n}return Object(b.a)(s,[{key:"changeText",value:function(e){this.setState({cur_text:e.target.value})}},{key:"changeCmp",value:function(e){this.setState({cur_cmp:e.target.value})}},{key:"changePoints",value:function(e){this.setState({cur_points:e.target.value})}},{key:"onAdd",value:function(){var e={id:ue()(),text:this.state.cur_text,operator:this.props.create_template.operator,cmp:this.state.cur_cmp,points:this.state.cur_points*("withdraws"===this.props.create_template.sign?-1:1)};this.props.onAdd(e,this.props.id),this.setState({cur_text:"",cur_cmp:"",cur_points:""})}},{key:"render",value:function(){var e=this,t=this.props.create_template,s=this.state,a=s.cur_text,r=s.cur_cmp,i=s.cur_points,c=null==t.operator;return Object(n.jsxs)($.a,{className:"mb-3",children:[Object(n.jsx)($.a.Prepend,{children:Object(n.jsx)(y.a,{variant:"outline-secondary",size:"sm",onClick:function(){return e.onAdd()},children:Object(n.jsx)(de.a,{})})}),Object(n.jsx)(N.a,{placeholder:this.state.placeholer_text,"aria-label":"Rule","aria-describedby":"basic-addon1",value:a,onChange:this.changeText}),c?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)($.a.Text,{id:"basic-addon1",children:t.operator}),Object(n.jsx)(N.a,{placeholder:this.state.placeholer_cmp,"aria-label":"number","aria-describedby":"basic-addon1",value:r,onChange:this.changeCmp})]}),Object(n.jsx)($.a.Text,{id:"basic-addon1",children:this.state.placeholer_sign}),Object(n.jsx)(N.a,{placeholder:this.state.placeholer_points,"aria-label":"points","aria-describedby":"basic-addon1",value:i,onChange:this.changePoints})]})}}]),s}(r.a.Component),me=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={rules:be,message:n.props.neg_state.basket.message,basket_size:n.props.neg_state.basket.score_rules.length},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.neg_state.basket)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){console.log("Updated bucket size: ",this.props.neg_state.basket.score_rules.length,this.props.neg_state.basket.status),this.setState({basket_size:e.score_rules.length,message:e.message})}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onAdd",value:function(e,t){var s=this;console.log("Created new rule: ",e),this.props.neg_state.basket.addRule(e,(function(e,t,n){return s.onError(e)})),this.setState({basket_size:this.props.neg_state.basket.score_rules.length})}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Negotiate Score"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.props.neg_state.basket.getRules((function(t,s){return e.onSuccess(t)}),(function(t,s){return e.onError(t)}))},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("h5",{children:[this.state.basket_size," ",Object(n.jsx)(L.a,{children:"entries in reward / penalty negotiation basket"}),":"]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/basket",children:Object(n.jsxs)(y.a,{variant:"primary",size:"lg",block:!0,children:[Object(n.jsx)(oe.a,{})," ",Object(n.jsx)(L.a,{children:"Review basket of rules"})]})}),this.state.rules.map((function(t,a){return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(je,{t:s,create_template:t,id:a,onAdd:function(t,s){return e.onAdd(t,s)}})})})),Object(n.jsx)(q,{value:s("Already used Templates"),link:"/negotiate_score/"+a+"/templates/used"}),Object(n.jsx)(q,{value:s("Parent/Child Templates"),link:"/negotiate_score/"+a+"/templates/parent"}),Object(n.jsx)(q,{value:s("Self Management Templates"),link:"/negotiate_score/"+a+"/templates/self"}),Object(n.jsx)(q,{value:s("Review Submitted rule baskets"),link:"/negotiate_score/"+a+"/submitted_baskets"})]})]})]})}}]),s}(r.a.Component),pe=s(338),ge=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props,t=e.rule,s=e.id,a=e.onEdit,r=e.onDelete,i=e.allowChange,c=null==t.operator;return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{style:{"min-width":"10em"},colSpan:c?3:1,children:Object(n.jsx)(L.a,{children:t.text})}),c?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{style:{"min-width":"2em"},children:t.operator}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.cmp})})]}),Object(n.jsx)("td",{style:{"min-width":"2em",textAlign:"right"},children:t.points}),Object(n.jsx)("td",{children:i?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return a(s)},children:Object(n.jsx)(pe.a,{})}),Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return r(s)},children:Object(n.jsx)(ee.a,{})})]}):Object(n.jsx)(n.Fragment,{})})]})}}]),s}(r.a.Component),Oe=s(339),fe=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;Object(h.a)(this,s),(n=t.call(this,e)).changeText=n.changeText.bind(Object(A.a)(n)),n.changeCmp=n.changeCmp.bind(Object(A.a)(n)),n.changePoints=n.changePoints.bind(Object(A.a)(n));var a=n.props.t;return n.state={cur_text:a(n.props.rule.text),cur_cmp:a(n.props.rule.cmp),cur_points:n.props.rule.points},n}return Object(b.a)(s,[{key:"changeText",value:function(e){this.setState({cur_text:e.target.value})}},{key:"changeCmp",value:function(e){this.setState({cur_cmp:e.target.value})}},{key:"changePoints",value:function(e){this.setState({cur_points:e.target.value})}},{key:"onAccept",value:function(){this.props.rule.text=this.state.cur_text,this.props.rule.cmp=this.state.cur_cmp,this.props.rule.points=this.state.cur_points,this.props.onAccept(this.props.id)}},{key:"render",value:function(){var e=this,t=this.props.t,s=this.state,a=s.cur_text,r=s.cur_cmp,i=s.cur_points,c=null==this.props.rule.operator;return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{style:{"min-width":"10em"},colSpan:c?3:1,children:Object(n.jsx)(N.a,{as:"textarea",placeholder:t(c?"Some quantity ...":"Some rule ..."),"aria-label":"Rule","aria-describedby":"basic-addon1",value:a,onChange:this.changeText})}),c?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{children:this.props.rule.operator}),Object(n.jsx)("td",{style:{"min-width":"4em"},children:Object(n.jsx)(N.a,{placeholder:t("number"),"aria-label":"Rule","aria-describedby":"basic-addon1",value:r,onChange:this.changeCmp})})]}),Object(n.jsx)("td",{style:{"min-width":"4em",textAlign:"right"},children:Object(n.jsx)(N.a,{placeholder:t("points (< 10 for small things)"),"aria-label":"points","aria-describedby":"basic-addon1",value:i,onChange:this.changePoints})}),Object(n.jsx)("td",{children:Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return e.onAccept()},children:Object(n.jsx)(Oe.a,{})})})]})}}]),s}(r.a.Component),ke=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props,t=e.rule,s=e.id,a=e.onClick,r=e.onEdit,i=e.onDelete,c=e.allowChange,o=null==t.operator;return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{style:{"min-width":"10em"},colSpan:o?3:1,children:Object(n.jsx)(y.a,{variant:"outline",size:"sm",onClick:function(){return a(s)},children:Object(n.jsx)("div",{class:"text-left",children:Object(n.jsx)(L.a,{children:t.text})})})}),o?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{style:{"min-width":"2em"},children:t.operator}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.cmp})})]}),Object(n.jsx)("td",{style:{"min-width":"2em",textAlign:"right"},children:t.points}),Object(n.jsx)("td",{children:c?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return r(s)},children:Object(n.jsx)(pe.a,{})}),Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return i(s)},children:Object(n.jsx)(ee.a,{})})]}):Object(n.jsx)(n.Fragment,{})})]})}}]),s}(r.a.Component),xe=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={editIdx:-1},n}return Object(b.a)(s,[{key:"onEdit",value:function(e){this.setState({editIdx:e})}},{key:"onDelete",value:function(e){this.setState({editIdx:-1}),this.props.onDelete(e,this.props.rules[e])}},{key:"onAccept",value:function(e){this.setState({editIdx:-1}),this.props.onChange(e,this.props.rules[e])}},{key:"onClick",value:function(e){this.setState({editIdx:-1}),this.props.onClick(e,this.props.rules[e])}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.allowClick,r=t.allowChange;return Object(n.jsxs)(X.a,{striped:!0,bordered:!0,hover:!0,size:"sm",responsive:"lg",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{colSpan:"4",style:{textAlign:"right"},children:Object(n.jsx)(L.a,{children:"points"})}),Object(n.jsx)("th",{})]})}),Object(n.jsx)("tbody",{children:"loading"===this.props.status?Object(n.jsx)(_.a,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}):this.props.rules.map((function(t,i){return Object(n.jsx)(n.Fragment,{children:e.state.editIdx===i&&r?Object(n.jsx)(fe,{t:s,rule:t,id:i,onAccept:function(){return e.onAccept(i)}}):a?Object(n.jsx)(ke,{t:s,rule:t,id:i,onClick:function(){return e.onClick(i)},onEdit:function(){return e.onEdit(i)},onDelete:function(){return e.onDelete(i)},allowChange:r}):Object(n.jsx)(ge,{t:s,rule:t,id:i,onEdit:function(){return e.onEdit(i)},onDelete:function(){return e.onDelete(i)},allowChange:r})})}))})]})}}]),s}(r.a.Component),ve=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={message:n.props.neg_state.basket.message,basket_size:n.props.neg_state.basket.score_rules.length},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.neg_state.basket)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){this.setState({basket_size:e.score_rules.length}),console.log("Updated bucket size: ",this.state.basket_size)}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onSuccess",value:function(e){this.setState({message:e.message})}},{key:"onClick",value:function(e,t){var s=this,n=Object(o.a)({},t);n.id=ue()(),this.props.neg_state.basket.addRule(n,(function(e,t,n){return s.onError(e)})),this.setState({basket_size:this.props.neg_state.basket.score_rules.length})}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.neg_state,r=t.member,i=t.template;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:r}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+r+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Score"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+r+"/templates/"+i+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Templates"})})})]}),Object(n.jsxs)(K.a,{children:[Object(n.jsx)("h4",{children:Object(n.jsxs)(L.a,{children:[i," templates"]})}),""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.props.neg_state.basket.getRules((function(t,s){return e.onSuccess(t)}),(function(t,s){return e.onError(t)}))},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("h5",{children:[this.state.basket_size," ",Object(n.jsx)(L.a,{children:"entries in reward / penalty negotiation basket"}),":"]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+r+"/basket",children:Object(n.jsxs)(y.a,{variant:"primary",size:"lg",block:!0,children:[Object(n.jsx)(oe.a,{})," ",Object(n.jsx)(L.a,{children:"Review basket of rules"})]})}),Object(n.jsx)(xe,{t:s,rules:a.templates.score[i],allowClick:!0,onClick:function(t,s){return e.onClick(t,s)}})]})]})]})}}]),s}(r.a.Component);var _e={used:[],parent:[{id:ue()(),text:"Favorite meal once a week",operator:">",cmp:"1500"},{id:ue()(),text:"10% pocket money raise",operator:">",cmp:"3000"},{id:ue()(),text:"10% pocket money reduction",operator:"<",cmp:"350"},{id:ue()(),text:"30% budget increase for buying cloths",operator:">",cmp:"8000"},{id:ue()(),text:"20% budget increase for buying cloths",operator:">",cmp:"4000"},{id:ue()(),text:"10% budget increase for buying cloths",operator:">",cmp:"2000"},{id:ue()(),text:"10% budget decrease for buying cloths",operator:"<",cmp:"500"},{id:ue()(),text:"20% budget decrease for buying cloths",operator:"<",cmp:"250"},{id:ue()(),text:"30% budget decrease for buying cloths",operator:"<",cmp:"125"},{id:ue()(),text:"10% christmas present value increase",operator:"once above",cmp:"2500",operator2:"not below",cmp2:"1000"},{id:ue()(),text:"10% christmas present value decrease",operator:"once below",cmp:"400",operator2:"not above",cmp2:"1000"},{id:ue()(),text:"20% birthday present value increase",operator:"average above",cmp:"1500",operator2:"over this many weeks",cmp2:"20"},{id:ue()(),text:"20% birthday present value decrease",operator:"average below",cmp:"750",operator2:"over this many weeks",cmp2:"20"}],self:[{id:ue()(),text:"Non-healthy meal once a week",operator:">",cmp:"1500"},{id:ue()(),text:"10% pocket money raise",operator:">",cmp:"3000"},{id:ue()(),text:"10% pocket money reduction",operator:"<",cmp:"350"},{id:ue()(),text:"20% budget increase for buying cloths",operator:">",cmp:"2000"},{id:ue()(),text:"10% budget increase for buying cloths",operator:">",cmp:"1500"},{id:ue()(),text:"10% budget decrease for buying cloths",operator:"<",cmp:"750"},{id:ue()(),text:"20% budget decrease for buying cloths",operator:"<",cmp:"500"},{id:ue()(),text:"20% budget increase for summer vacation",operator:"once above",cmp:"2500",operator2:"not below",cmp2:"1000"},{id:ue()(),text:"20% budget decrease for summer vacation",operator:"once below",cmp:"400",operator2:"not above",cmp2:"1000"},{id:ue()(),text:"Always icecream in the fridge",operator:"average above",cmp:"1500",operator2:"over this many weeks",cmp2:"20"},{id:ue()(),text:"No buying of sweets",operator:"average below",cmp:"750",operator2:"over this many weeks",cmp2:"20"}]},ye=[{text:"Some reward that plays out any moment",operator:">",cmp:"score (between 1000 and 9999)",tip:"this rule makes the score have direct impact on everyday life"},{text:"Some penalty that plays out any moment",operator:"<",cmp:"score (between 100 and 1000)",tip:"this rule makes the score have direct impact on everyday life"},{text:"Some reward for a specific moment in the future",operator:"once above",cmp:"score > 1000",operator2:"and not below",cmp2:"any score",tip:"this rule avoids that benefits at a specific time depend on the score on this special day"},{text:"Some penalty for a specific moment in the future",operator:"once below",cmp:"score < 1000",operator2:"and not above",cmp2:"any score",tip:"this rule avoids that penalties at a specific time depend on the score on this special day"},{text:"Some reward based on longer term behavior",operator:"average above",cmp:"avg score > 1000",operator2:"over this many weeks",cmp2:"#weeks",tip:"this rule merits longer term behavior"},{text:"Some penalty based on longer term behavior",operator:"average below",cmp:"avg score < 1000",operator2:"over this many weeks",cmp2:"#weeks",tip:"this rule merits longer term behavior"}],Se=s(346),we=s(341),Ce=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;Object(h.a)(this,s),(n=t.call(this,e)).changeText=n.changeText.bind(Object(A.a)(n)),n.changeCmp=n.changeCmp.bind(Object(A.a)(n)),n.changeCmp2=n.changeCmp2.bind(Object(A.a)(n));var a=n.props,r=a.t,i=a.create_template;return n.state={placeholer_text:r(i.text),placeholer_cmp:r(i.cmp),placeholer_cmp2:r(i.cmp2),tip:r(i.tip),cur_text:"",cur_cmp:"",cur_cmp2:"",cur_points:""},n}return Object(b.a)(s,[{key:"changeText",value:function(e){this.setState({cur_text:e.target.value})}},{key:"changeCmp",value:function(e){this.setState({cur_cmp:e.target.value})}},{key:"changeCmp2",value:function(e){this.setState({cur_cmp2:e.target.value})}},{key:"onAdd",value:function(){var e={id:ue()(),text:this.state.cur_text,operator:this.props.create_template.operator,cmp:this.state.cur_cmp,operator2:this.props.create_template.operator2,cmp2:this.state.cur_cmp2};this.props.onAdd(e,this.props.id),this.setState({cur_text:"",cur_cmp:"",cur_cmp2:""})}},{key:"render",value:function(){var e=this,t=this.props.create_template,s=this.state,a=s.cur_text,r=s.cur_cmp,i=s.cur_cmp2,c=null==t.operator2;return Object(n.jsxs)($.a,{className:"mb-3",children:[Object(n.jsx)($.a.Prepend,{children:Object(n.jsx)(Se.a,{placement:"top",overlay:Object(n.jsx)(we.a,{id:"tooltip",children:this.state.tip}),children:Object(n.jsx)(y.a,{variant:"outline-secondary",size:"sm",onClick:function(){return e.onAdd()},children:Object(n.jsx)(de.a,{})})},"top")}),Object(n.jsx)(N.a,{placeholder:this.state.placeholer_text,"aria-label":"Rule","aria-describedby":"basic-addon1",value:a,onChange:this.changeText}),Object(n.jsx)($.a.Text,{id:"basic-addon1",children:Object(n.jsx)(L.a,{children:t.operator})}),Object(n.jsx)(N.a,{placeholder:this.state.placeholer_cmp,"aria-label":"cmp","aria-describedby":"basic-addon1",value:r,onChange:this.changeCmp}),c?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)($.a.Text,{id:"basic-addon1",children:Object(n.jsx)(L.a,{children:t.operator2})}),Object(n.jsx)(N.a,{placeholder:this.state.placeholer_cmp2,"aria-label":"cmp2","aria-describedby":"basic-addon1",value:i,onChange:this.changeCmp2})]})]})}}]),s}(r.a.Component),Ie=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={rules:ye,message:n.props.neg_state.basket.message,basket_size:n.props.neg_state.basket.real_rules.length},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.neg_state.basket)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){console.log("Updated bucket size: ",this.props.neg_state.basket.real_rules.length,this.props.neg_state.basket.status),this.setState({basket_size:e.real_rules.length,message:e.message})}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onAdd",value:function(e,t){var s=this;console.log("Created new rule: ",e),this.props.neg_state.basket.addRule(e,(function(e,t,n){return s.onError(e)})),this.setState({basket_size:this.props.neg_state.basket.real_rules.length})}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Negotiate Real"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.props.neg_state.basket.getRules((function(t,s){return e.onSuccess(t)}),(function(t,s){return e.onError(t)}))},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("h5",{children:[this.state.basket_size," ",Object(n.jsx)(L.a,{children:"entries in real effect negotiation basket"}),":"]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/basket",children:Object(n.jsxs)(y.a,{variant:"primary",size:"lg",block:!0,children:[Object(n.jsx)(oe.a,{})," ",Object(n.jsx)(L.a,{children:"Review basket of rules"})]})}),this.state.rules.map((function(t,a){return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(Ce,{t:s,create_template:t,id:a,onAdd:function(t,s){return e.onAdd(t,s)}})})})),Object(n.jsx)(q,{value:s("Already used Templates"),link:"/negotiate_real/"+a+"/templates/used"}),Object(n.jsx)(q,{value:s("Parent/Child Templates"),link:"/negotiate_real/"+a+"/templates/parent"}),Object(n.jsx)(q,{value:s("Self Management Templates"),link:"/negotiate_real/"+a+"/templates/self"}),Object(n.jsx)(q,{value:s("Review Submitted rule baskets"),link:"/negotiate_real/"+a+"/submitted_baskets"})]})]})]})}}]),s}(r.a.Component),ze=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props,t=e.rule,s=e.id,a=e.onEdit,r=e.onDelete,i=e.allowChange,c=null==t.operator2;return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{style:{"min-width":"10em"},colSpan:c?3:1,children:Object(n.jsx)(L.a,{children:t.text})}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.operator})}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.cmp})}),c?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.operator2})}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.cmp2})})]}),Object(n.jsx)("td",{children:i?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return a(s)},children:Object(n.jsx)(pe.a,{})}),Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return r(s)},children:Object(n.jsx)(ee.a,{})})]}):Object(n.jsx)(n.Fragment,{})})]})}}]),s}(r.a.Component),Re=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;Object(h.a)(this,s),(n=t.call(this,e)).changeText=n.changeText.bind(Object(A.a)(n)),n.changeCmp=n.changeCmp.bind(Object(A.a)(n)),n.changeCmp2=n.changeCmp2.bind(Object(A.a)(n));var a=n.props.t;return n.state={cur_text:a(n.props.rule.text),cur_cmp:a(n.props.rule.cmp),cur_cmp2:a(n.props.rule.cmp2)},n}return Object(b.a)(s,[{key:"changeText",value:function(e){this.setState({cur_text:e.target.value})}},{key:"changeCmp",value:function(e){this.setState({cur_cmp:e.target.value})}},{key:"changeCmp2",value:function(e){this.setState({cur_cmp2:e.target.value})}},{key:"onAccept",value:function(){this.props.rule.text=this.state.cur_text,this.props.rule.cmp=this.state.cur_cmp,this.props.rule.cmp2=this.state.cur_cmp2,this.props.onAccept(this.props.id)}},{key:"render",value:function(){var e=this,t=this.props.t,s=this.state,a=s.cur_text,r=s.cur_cmp,i=s.cur_cmp2,c=null==this.props.rule.operator2;return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{style:{"min-width":"10em"},colSpan:c?3:1,children:Object(n.jsx)(N.a,{as:"textarea",placeholder:t("Some rule ..."),"aria-label":"Rule","aria-describedby":"basic-addon1",value:a,onChange:this.changeText})}),Object(n.jsx)("td",{children:Object(n.jsx)(L.a,{children:this.props.rule.operator})}),Object(n.jsx)("td",{style:{"min-width":"4em",textAlign:"right"},children:Object(n.jsx)(N.a,{placeholder:t("points"),"aria-label":"cmp","aria-describedby":"basic-addon1",value:r,onChange:this.changeCmp})}),c?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{children:Object(n.jsx)(L.a,{children:this.props.rule.operator2})}),Object(n.jsx)("td",{style:{"min-width":"4em",textAlign:"right"},children:Object(n.jsx)(N.a,{placeholder:t("points"),"aria-label":"cmp2","aria-describedby":"basic-addon1",value:i,onChange:this.changeCmp2})})]}),Object(n.jsx)("td",{children:Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return e.onAccept()},children:Object(n.jsx)(Oe.a,{})})})]})}}]),s}(r.a.Component),Be=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props,t=e.rule,s=e.id,a=e.onClick,r=e.onEdit,i=e.onDelete,c=e.allowChange,o=null==t.operator2;return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{style:{"min-width":"10em"},colSpan:o?3:1,children:Object(n.jsx)(y.a,{variant:"outline",size:"sm",onClick:function(){return a(s)},children:Object(n.jsx)("div",{class:"text-left",children:Object(n.jsx)(L.a,{children:t.text})})})}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.operator})}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.cmp})}),o?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.operator2})}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.cmp2})})]}),Object(n.jsx)("td",{children:c?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return r(s)},children:Object(n.jsx)(pe.a,{})}),Object(n.jsx)(y.a,{variant:"light",size:"sm",onClick:function(){return i(s)},children:Object(n.jsx)(ee.a,{})})]}):Object(n.jsx)(n.Fragment,{})})]})}}]),s}(r.a.Component),Fe=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={editIdx:-1},n}return Object(b.a)(s,[{key:"onEdit",value:function(e){this.setState({editIdx:e})}},{key:"onDelete",value:function(e){this.setState({editIdx:-1}),this.props.onDelete(e,this.props.rules[e])}},{key:"onAccept",value:function(e){this.setState({editIdx:-1}),this.props.onChange(e,this.props.rules[e])}},{key:"onClick",value:function(e){this.setState({editIdx:-1}),this.props.onClick(e,this.props.rules[e])}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.allowClick,r=t.allowChange;return Object(n.jsxs)(X.a,{striped:!0,bordered:!0,hover:!0,size:"sm",responsive:"lg",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{colSpan:"3",style:{textAlign:"right"},children:Object(n.jsx)(L.a,{children:"points"})}),Object(n.jsx)("th",{colSpan:"2",style:{textAlign:"right"},children:Object(n.jsx)(L.a,{children:"points"})})]})}),Object(n.jsx)("tbody",{children:"loading"===this.props.status?Object(n.jsx)(_.a,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}):this.props.rules.map((function(t,i){return Object(n.jsx)(n.Fragment,{children:e.state.editIdx===i&&r?Object(n.jsx)(Re,{t:s,rule:t,id:i,onAccept:function(){return e.onAccept(i)}}):a?Object(n.jsx)(Be,{t:s,rule:t,id:i,onClick:function(){return e.onClick(i)},onEdit:function(){return e.onEdit(i)},onDelete:function(){return e.onDelete(i)},allowChange:r}):Object(n.jsx)(ze,{t:s,rule:t,id:i,onEdit:function(){return e.onEdit(i)},onDelete:function(){return e.onDelete(i)},allowChange:r})})}))})]})}}]),s}(r.a.Component),Ee=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={message:n.props.neg_state.basket.message,basket_size:n.props.neg_state.basket.real_rules.length},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.neg_state.basket)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){this.setState({basket_size:e.real_rules.length}),console.log("Updated bucket size: ",this.state.basket_size)}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onSuccess",value:function(e){this.setState({message:e.message})}},{key:"onClick",value:function(e,t){var s=this,n=Object(o.a)({},t);n.id=ue()(),this.props.neg_state.basket.addRule(n,(function(e,t,n){return s.onError(e)})),this.setState({basket_size:this.props.neg_state.basket.real_rules.length})}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.neg_state,r=t.member,i=t.template;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:r}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+r+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Real"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+r+"/templates/"+i+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Templates"})})})]}),Object(n.jsxs)(K.a,{children:[Object(n.jsx)("h4",{children:Object(n.jsxs)(L.a,{children:[i," templates"]})}),""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.props.neg_state.basket.getRules((function(t,s){return e.onSuccess(t)}),(function(t,s){return e.onError(t)}))},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("h5",{children:[this.state.basket_size," ",Object(n.jsx)(L.a,{children:"entries in real effect negotiation basket"}),":"]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+r+"/basket",children:Object(n.jsxs)(y.a,{variant:"primary",size:"lg",block:!0,children:[Object(n.jsx)(oe.a,{})," ",Object(n.jsx)(L.a,{children:"Review basket of rules"})]})}),Object(n.jsx)(Fe,{t:s,rules:a.templates.real[i],allowClick:!0,onClick:function(t,s){return e.onClick(t,s)}})]})]})]})}}]),s}(r.a.Component),Le=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={message:"",activeRules:[],numOccurred:0},n.lookupBasket={},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to active baskets loaded / current size=",this.props.neg_state.activeBaskets.baskets.length),this.props.neg_state.activeBaskets.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.props.neg_state.activeOtherBaskets.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.neg_state.activeBaskets)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.activeBaskets.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){console.log("Updated active baskets: ",this.props.neg_state.activeBaskets.baskets.length,this.props.neg_state.activeBaskets.status),console.log("Updated active other baskets: ",this.props.neg_state.activeOtherBaskets.baskets.length,this.props.neg_state.activeOtherBaskets.status),this.updateActiveBaskets()}},{key:"checkValid",value:function(e){var t=Date.parse(e.timestamp)+7*e.valid_weeks*86400*1e3;return Date.now()<t}},{key:"addRulesFromBaskets",value:function(e,t,s){var n,a=this,r=Object(u.a)(t.baskets);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.checkValid(i)&&function(){e=e.concat(i.rules);var t={basketId:i.basket_id,isOtherBasket:s};i.rules.forEach((function(e){a.lookupBasket[e.id]=t}))}()}}catch(c){r.e(c)}finally{r.f()}return e}},{key:"updateActiveBaskets",value:function(){var e=[];e=this.addRulesFromBaskets(e,this.props.neg_state.activeBaskets,!1),e=this.addRulesFromBaskets(e,this.props.neg_state.activeOtherBaskets,!0),this.setState({activeRules:e})}},{key:"onOccurrenceSuccess",value:function(){this.setState({numOccurred:this.state.numOccurred+1,message:this.props.score.message})}},{key:"onOccurrenceError",value:function(){this.setState({message:this.props.score.message})}},{key:"onClickRule",value:function(e,t){var s=this,n=this.lookupBasket[t.id];this.props.neg_state.occurrences.addOccurrence(n.isOtherBasket,n.basketId,t.id,this.props.score,(function(){return s.onOccurrenceSuccess()}),(function(){return s.onOccurrenceError()}))}},{key:"refresh",value:function(){var e=this;this.props.getScore((function(){}),(function(){return e.onOccurrenceError()}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/update_score/"+a+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Update Score"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"Please click active rules that occurred"})," ",Object(n.jsx)(k.a,{children:this.state.numOccurred})]}),Object(n.jsx)(xe,{t:s,rules:this.state.activeRules,onClick:function(t,s){return e.onClickRule(t,s)},allowClick:!0})]})]})}}]),s}(r.a.Component),Ue=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).changeValidWeeks=n.changeValidWeeks.bind(Object(A.a)(n)),n.state={score:0,neg_state:n.props.neg_state,message:"",basket_status:n.props.neg_state.basket.status,basket_size:n.props.neg_state.basket.score_rules.length,basket_rules:[],validWeeks:8},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.state.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.state.neg_state.basket)}},{key:"componentWillUnmount",value:function(){this.state.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){console.log("Updated bucket size: ",this.state.neg_state.basket.score_rules.length,this.state.neg_state.basket.status),this.setState({basket_status:e.status,basket_size:e.score_rules.length,basket_rules:e.score_rules,message:e.message})}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onSuccess",value:function(e){this.setState({message:e.message})}},{key:"onSubmitSuccess",value:function(e){this.setState({basket_status:this.state.neg_state.basket.status,basket_rules:this.state.neg_state.basket.score_rules,basket_size:this.state.neg_state.basket.score_rules.length,message:this.state.neg_state.basket.message}),this.props.history.push("/negotiate_score/"+this.props.member+"/submitted_baskets")}},{key:"onEdit",value:function(e,t){var s=this;this.state.neg_state.basket.updateRule(t,(function(e,t,n){return s.onError(e,t,n)}))}},{key:"onDelete",value:function(e,t){var s=this;this.state.neg_state.basket.deleteRule(t,(function(e,t,n){return s.onError(e,t,n)})),this.setState({basket_status:this.state.neg_state.basket.status,basket_rules:this.state.neg_state.basket.score_rules,basket_size:this.state.neg_state.basket.score_rules.length,message:this.state.neg_state.basket.message})}},{key:"onSubmit",value:function(){var e=this;this.state.neg_state.basket.submit(this.state.validWeeks,(function(t){return e.onSubmitSuccess(t)}),(function(t){return e.onError(t)}))}},{key:"changeValidWeeks",value:function(e){this.setState({validWeeks:e.target.value})}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Score"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/basket",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Basket"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.state.neg_state.basket.getRules((function(t,s){return e.onSuccess(t)}),(function(t,s){return e.onError(t)}))},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),"loading"===this.state.neg_state.basket.state?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D.Spinner,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}),Object(n.jsx)(y.a,{size:"sm",onClick:function(){return e.state.neg_state.basket.getRules()},children:Object(n.jsx)(w.a,{})})]}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("h5",{children:[this.state.basket_size," ",Object(n.jsx)(L.a,{children:"entries in reward / penalty negotiation basket"}),":"]}),Object(n.jsx)(xe,{t:s,rules:this.state.basket_rules,status:this.state.basket_status,onChange:function(t,s){return e.onEdit(t,s)},onDelete:function(t,s){return e.onDelete(t,s)},allowChange:!0}),Object(n.jsx)("h5",{children:Object(n.jsx)(L.a,{children:"These rules shall be valid for:"})}),Object(n.jsxs)($.a,{className:"mb-3",children:[Object(n.jsx)(N.a,{placeholder:s("recommended are 2 months since frequent renegotiation keeps rules effective"),"aria-label":"validity_weeks","aria-describedby":"basic-addon1",value:this.state.validWeeks,onChange:this.changeValidWeeks}),Object(n.jsx)($.a.Append,{children:Object(n.jsx)($.a.Text,{id:"basic-addon2",children:Object(n.jsx)(L.a,{children:"weeks"})})})]}),Object(n.jsx)(y.a,{onClick:function(){return e.onSubmit()},block:!0,children:Object(n.jsx)(L.a,{children:"Submit"})})]})]})]})}}]),s}(r.a.Component),Ae=s(197),Te=s.n(Ae),Me=s(132),Pe=function(){function e(t,s,n){Object(h.a)(this,e),this.t=t,this.status="loading",this.member=s,this.type=n,this.message="",this.subscribers_loaded={},this.subscribers_change={},this.ruleIds=new Set}return Object(b.a)(e,[{key:"subscribe_change",value:function(e,t){this.subscribers_change[e]=t}},{key:"unsubscribe_change",value:function(e){delete this.subscribers_change[e]}},{key:"subscribe_loaded",value:function(e,t){this.subscribers_loaded[e]=t}},{key:"unsubscribe_loaded",value:function(e){delete this.subscribers_loaded[e]}},{key:"_notify_subscribers_change",value:function(){console.log("Basket Notifying change subscribers: ",this.type,Object.keys(this.subscribers_change).length);for(var e=0,t=Object.values(this.subscribers_change);e<t.length;e++){(0,t[e])(this)}}},{key:"_notify_subscribers_loaded",value:function(){console.log("Basket Notifying status subscribers: ",this.type,Object.keys(this.subscribers_loaded).length);for(var e=0,t=Object.values(this.subscribers_loaded);e<t.length;e++){(0,t[e])(this)}}},{key:"_verifySchema",value:function(e){throw new Error("pure abstract method")}},{key:"_setRules",value:function(e){throw new Error("pure abstract method")}},{key:"addRule",value:function(e,t){var s=this;this._verifySchema([e]),"loading"===this.status||"error"===this.status?(this.message="Failed adding rule. Please wait for basket to finish loading or hit reload.",void 0!==t&&t(this,e,new Error(this.message))):"loaded"!==this.status?(this.message="Failed adding rule. Please wait for basket change to finish or hit reload.",void 0!==t&&t(this,e,new Error(this.message))):(this.status="updating",this.ruleIds.add(e.id),this._addRules([e]),F((function(n,a){return fetch(E.url+"/negotiate-rule",{method:"PUT",mode:"cors",headers:{Authorization:n},body:JSON.stringify({member_uid:s.member,type:s.type,rule:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){console.log("#BE# Added Rule",s.type,s.member,e),s.status="loaded"})).catch((function(n){console.log(n),s.status="error",s.message="Failed adding negotiation rule due to connection problems. Please hit reload.",void 0!==t&&t(s,e,n)}))})))}},{key:"addRules",value:function(e,t){var s=this;this._verifySchema(e),"loading"===this.status||"error"===this.status?(this.message="Failed adding rules. Please wait for basket to finish loading or hit reload.",void 0!==t&&t(this,e,new Error(this.message))):"loaded"!==this.status?(this.message="Failed adding rules. Please wait for basket change to finish or hit reload.",void 0!==t&&t(this,e,new Error(this.message))):(this.status="updating",e.forEach((function(e){return s.ruleIds.add(e.id)})),this._addRules(e),F((function(n,a){return fetch(E.url+"/negotiate-rules",{method:"PUT",mode:"cors",headers:{Authorization:n},body:JSON.stringify({member_uid:s.member,type:s.type,rules:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){console.log("#BE# Added Rules",s.type,s.member,e),s.status="loaded"})).catch((function(n){console.log(n),s.status="error",s.message="Failed adding negotiation rules due to connection problems. Please hit reload.",void 0!==t&&t(s,e,n)}))})))}},{key:"setRules",value:function(e,t){var s=this;if(this._verifySchema(e),"loading"===this.status||"error"===this.status)this.message="Failed adding rules. Please wait for basket to finish loading or hit reload.",void 0!==t&&t(this,e,new Error(this.message));else if("loaded"!==this.status)this.message="Failed adding rules. Please wait for basket change to finish or hit reload.",void 0!==t&&t(this,e,new Error(this.message));else{this.status="updating";var n=new Set(this.ruleIds);this.ruleIds=new Set,e.forEach((function(e){return s.ruleIds.add(e.id)})),this._setRules(e),F((function(a,r){return fetch(E.url+"/negotiate-rules",{method:"PUT",mode:"cors",headers:{Authorization:a},body:JSON.stringify({member_uid:s.member,type:s.type,rules:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(a){console.log("#BE# Added Rules",s.type,s.member,e),s.status="loaded",F((function(a,r){return fetch(E.url+"/negotiate-rules",{method:"DELETE",mode:"cors",headers:{Authorization:a},body:JSON.stringify({member_uid:s.member,type:s.type,rule_ids:Object(Me.a)(n)})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(e){console.log("#BE# Successfully cleared old rules",s.type,s.member,n)})).catch((function(n){console.log(n),s.status="error",s.message="Failed replacing negotiation rules due to connection problems. Please hit reload.",void 0!==t&&t(s,e,n)}))}))})).catch((function(n){console.log(n),s.status="error",s.message="Failed adding negotiation rules due to connection problems. Please hit reload.",void 0!==t&&t(s,e,n)}))}))}}},{key:"updateRule",value:function(e,t){var s=this;this._verifySchema([e]),"loading"===this.status||"error"===this.status?(this.message="Failed updating rule. Please wait for basket to finish loading or hit reload.",void 0!==t&&t(this,e,new Error(this.message))):"loaded"===this.status&&this.ruleIds.has(e.id)?(this.status="updating",this._updateRules([e]),F((function(n,a){return fetch(E.url+"/negotiate-rule",{method:"PUT",mode:"cors",headers:{Authorization:n},body:JSON.stringify({member_uid:s.member,rule_id:e.id,type:s.type,rule:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){console.log("#BE# Updated Rule: ",s.type,s.member,e),s.status="loaded"})).catch((function(n){console.log(n),s.status="error",s.message="Failed updating negotiation rule due to connection problems. Please hit reload.",void 0!==t&&t(s,e,n)}))}))):(this.message="Failed updating rule. Please wait for basket change to finish or hit reload.",void 0!==t&&t(this,e,new Error(this.message)))}},{key:"deleteRule",value:function(e,t){var s=this;this._verifySchema([e]),"loading"===this.status||"error"===this.status?(this.message="Failed deleting rule. Please wait for basket to finish loading or hit reload.",void 0!==t&&t(this,e,new Error(this.message))):"loaded"!==this.status?(this.message="Failed deleting rule. Please wait for basket change to finish or hit reload.",void 0!==t&&t(this,e,new Error(this.message))):(this.status="updating",this.ruleIds.delete(e.id),this._deleteRules([e]),F((function(n,a){return fetch(E.url+"/negotiate-rule",{method:"DELETE",mode:"cors",headers:{Authorization:n},body:JSON.stringify({member_uid:s.member,rule_id:e.id,type:s.type,rule:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){console.log("#BE# Deleted Rule: ",s.type,s.member,e),s.status="loaded"})).catch((function(n){console.log(n),s.status="error",s.message="Failed updating negotiation rule due to connection problems. Please hit reload.",void 0!==t&&t(s,e,n)}))})))}},{key:"getRules",value:function(e,t){var s=this;F((function(n,a){return fetch(E.url+"/negotiate-rules?member_uid="+s.member+"&type="+s.type,{method:"GET",mode:"cors",headers:{Authorization:n}}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){console.log("#BE# Received Rules: ",s.type,t.rules,s.member),s._verifySchema(t.rules),s.status="loaded",s.message="",s.ruleIds=new Set(t.rules.map((function(e){return e.id}))),s._setRules(t.rules),s._notify_subscribers_loaded(),void 0!==e&&e(s,t.rules)})).catch((function(e){console.log(e),s.status="error",s.message="Failed loading negotiation rules due to connection problems. Please hit reload.",void 0!==t&&t(s,e)}))}))}},{key:"submit",value:function(e,t,s){var n=this;"loading"===this.status||"error"===this.status?(this.message="Failed submitting basket. Please wait for basket to finish loading or hit reload.",void 0!==s&&s(this,new Error(this.message))):"loaded"!==this.status?(this.message="Failed submitting basket. Please wait for basket change to finish or hit reload.",void 0!==s&&s(this,new Error(this.message))):(this.status="submitting",F((function(a,r){return fetch(E.url+"/baskets",{method:"POST",mode:"cors",headers:{Authorization:a},body:JSON.stringify({member_uid:n.member,rule_ids:Object(Me.a)(n.ruleIds),type:n.type,valid_weeks:e})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(e){console.log("#BE# Bucket Submit Success: ",n.type,n.member,e.basket_id),n.ruleIds=new Set,n.status="loaded",n.message="",n._setRules([]),n._notify_subscribers_loaded(),void 0!==t&&t(n,e.basket_id,e.timestamp)})).catch((function(e){console.log(e),n.status="error",n.message="Failed submitting negotiation rules due to connection problems. Please try again.",void 0!==s&&s(n,e)}))})))}}]),e}(),Ne=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e,n){var a;return Object(h.a)(this,s),(a=t.call(this,e,n,"score")).score_rules=[],a}return Object(b.a)(s,[{key:"_verifySchema",value:function(e){for(var t=0;t<e.length;++t){var s=e[t];if(!("id"in s&&"text"in s&&"points"in s))throw new Error("Fatal error: rule violated schema for score negotiation rules")}}},{key:"_addRules",value:function(e){this._verifySchema(e),this.score_rules=this.score_rules.concat(e),this._notify_subscribers_change()}},{key:"_updateRules",value:function(e){this._verifySchema(e);for(var t={},s=0;s<this.score_rules.length;s++)t[this.score_rules[s].id]=s;var n,a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;this.score_rules[t[r.id]]=r}}catch(i){a.e(i)}finally{a.f()}this._notify_subscribers_change()}},{key:"_deleteRules",value:function(e){this._verifySchema(e);var t,s=[],n=Object(u.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;s=a.id}}catch(r){n.e(r)}finally{n.f()}this.score_rules=this.score_rules.filter((function(e){return!s.includes(e.id)})),this._notify_subscribers_change()}},{key:"_setRules",value:function(e){this._verifySchema(e),this.score_rules=e,this._notify_subscribers_change()}}]),s}(Pe),De=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e,n){var a;return Object(h.a)(this,s),(a=t.call(this,e,n,"real")).real_rules=[],a}return Object(b.a)(s,[{key:"_verifySchema",value:function(e){for(var t=0;t<e.length;++t){var s=e[t];if(!("id"in s&&"operator"in s&&"cmp"in s&&"text"in s))throw new Error("Fatal error: rule violated schema for real negotiation rules")}}},{key:"_addRules",value:function(e){this._verifySchema(e),this.real_rules=this.real_rules.concat(e),this._notify_subscribers_change()}},{key:"_updateRules",value:function(e){this._verifySchema(e);for(var t={},s=0;s<this.real_rules.length;s++)t[this.real_rules[s].id]=s;var n,a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;this.real_rules[t[r.id]]=r}}catch(i){a.e(i)}finally{a.f()}this._notify_subscribers_change()}},{key:"_deleteRules",value:function(e){this._verifySchema(e);var t,s=[],n=Object(u.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;s=a.id}}catch(r){n.e(r)}finally{n.f()}this.real_rules=this.real_rules.filter((function(e){return!s.includes(e.id)})),this._notify_subscribers_change()}},{key:"_setRules",value:function(e){this._verifySchema(e),this.real_rules=e,this._notify_subscribers_change()}}]),s}(Pe),We=function(){function e(t,s,n,a,r){Object(h.a)(this,e),this.t=t,this.status="loading",this.member=s,this.parent="<unknown>",this.type=n,this.message="",this.subscribers_loaded={},this.subscribers_change={},this.baskets=[],this.basketIds={},this.filterActive=void 0!==a&&a,this.filterReview=void 0!==r&&r,this.filterActive&&this.filterReview&&console.log("Load active baskets from connected account")}return Object(b.a)(e,[{key:"subscribe_change",value:function(e,t){this.subscribers_change[e]=t}},{key:"unsubscribe_change",value:function(e){delete this.subscribers_change[e]}},{key:"subscribe_loaded",value:function(e,t){this.subscribers_loaded[e]=t}},{key:"unsubscribe_loaded",value:function(e){delete this.subscribers_loaded[e]}},{key:"_notify_subscribers_change",value:function(){console.log("Baskets Notifying change subscribers: ",this.type,Object.keys(this.subscribers_change).length);for(var e=0,t=Object.values(this.subscribers_change);e<t.length;e++){(0,t[e])(this)}}},{key:"_notify_subscribers_loaded",value:function(){console.log("Baskets Notifying status subscribers: ",this.type,Object.keys(this.subscribers_loaded).length);for(var e=0,t=Object.values(this.subscribers_loaded);e<t.length;e++){(0,t[e])(this)}}},{key:"accept",value:function(e,t,s){this._setStatus(e,"accepted",t,s,!0)}},{key:"reject",value:function(e,t,s){this._setStatus(e,"rejected",t,s,!0)}},{key:"_setStatus",value:function(e,t,s,n,a){var r=this,i=this.baskets[this.basketIds[e]].timestamp;F((function(c,o){return fetch(E.url+"/review-basket/status",{method:"PUT",mode:"cors",headers:{Authorization:c,"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({member_uid:r.member,type:r.type,timestamp:i,basket_id:e,status:t})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){if(r.message="",a){var n=r.basketIds[e];r.baskets.splice(n,1),delete r.basketIds[e]}s(r)})).catch((function(e){r.message="accepted"===t?"Failed accepting rules due to connection issue. Please retry.":"rejected"===t?"Failed rejecting rules due to connection issue. Please retry.":"Failed setting status for rules due to connection issue. Please retry.",console.log(e),n(r,e)}))}))}},{key:"getBaskets",value:function(e,t,s){var n=this;if(this.filterReview&&"myself"===this.member)console.log("there is nothing to review for self management"),void 0!==t&&t(this,[]);else{var a="",r=this.filterReview?"/review-baskets":"/baskets";this.filterActive?a="&filter_status=accepted":this.filterReview&&(a="&filter_status=pending"),F((function(i,c){return fetch(E.url+r+"?member_uid="+n.member+"&type="+n.type+"&weeks_old="+e+a,{method:"GET",mode:"cors",headers:{Authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(e){console.log("#BE# Received Baskets: ",n.type,e.baskets,n.member),n.status="loaded",n.message="",n.parent=e.parent_uid,n.baskets=e.baskets,n.basketIds=Object.fromEntries(n.baskets.map((function(e,t){return[e.basket_id,t]}))),n._notify_subscribers_change(),n._notify_subscribers_loaded(),void 0!==t&&t(n,e.baskets)})).catch((function(e){console.log(e),n.status="error",n.message="Failed loading negotiation rule baskets due to connection problems. Please hit reload.",void 0!==s&&s(n,e)}))}))}}}]),e}(),Ve=function(){function e(t,s){Object(h.a)(this,e),this.t=t,this.member=s,this.status="loading",this.message="",this.subscribers_loaded={},this.subscribers_change={}}return Object(b.a)(e,[{key:"onLoaded",value:function(){this.status="loaded",this.message="",this._notify_subscribers_change(),this._notify_subscribers_loaded()}},{key:"onChanged",value:function(){this.status="loaded",this.message="",this._notify_subscribers_change()}},{key:"onError",value:function(e){this.status="error",this.message=e}},{key:"subscribe_change",value:function(e,t){this.subscribers_change[e]=t}},{key:"unsubscribe_change",value:function(e){delete this.subscribers_change[e]}},{key:"subscribe_loaded",value:function(e,t){this.subscribers_loaded[e]=t}},{key:"unsubscribe_loaded",value:function(e){delete this.subscribers_loaded[e]}},{key:"_notify_subscribers_change",value:function(){console.log("notifying change subscribers: ",this.constructor.name,this.status,Object.keys(this.subscribers_change).length);for(var e=0,t=Object.values(this.subscribers_change);e<t.length;e++){(0,t[e])(this)}}},{key:"_notify_subscribers_loaded",value:function(){console.log("notifying status subscribers: ",this.constructor.name,this.status,Object.keys(this.subscribers_loaded).length);for(var e=0,t=Object.values(this.subscribers_loaded);e<t.length;e++){(0,t[e])(this)}}}]),e}(),Je=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e,n){var a;return Object(h.a)(this,s),(a=t.call(this,e,n)).occurrences=[],a}return Object(b.a)(s,[{key:"getOccurrences",value:function(e,t,s,n,a){var r=this;F((function(i,c){return fetch(E.url+"/occurrences?member_uid="+r.member+"&weeks_old="+e+"&max_items="+t+(null!==s&&void 0!==s?"&after_id="+s:""),{method:"GET",mode:"cors",headers:{Authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(e){console.log("#BE# Received score rule occurrences: ",r.type,e.baskets,r.member),r.occurrences=e.occurrences,r.onLoaded(),void 0!==n&&n(r,e.occurrences)})).catch((function(e){console.log(e),r.onError("Failed loading score rule occurrences due to connection problems. Please hit reload."),void 0!==a&&a(r,e)}))}))}},{key:"addOccurrence",value:function(e,t,s,n,a,r){var i=this;console.log("New Rule Occurrence: ",e,t,s),F((function(c,o){return fetch(E.url+"/occurrence",{method:"PUT",mode:"cors",headers:{Authorization:c,"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({member_uid:i.member,is_other_basket:e,basket_id:t,rule_id:s})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(e){i.occurrences.push(e.occurrence),n.setScore(e.occurrence.score),a(i,e.occurrences,i.score)})).catch((function(e){console.log("Score.addOccurrence error",e),i.status="error",i.message="Failed adding occurrence due to connection problems. Please hit reload.",r(i,e)}))}))}}]),s}(Ve),Ke=function(){function e(t,s,n,a){Object(h.a)(this,e),this.t=t,this.basket=a,this.type=n,this.weeks_old=104,this.submittedBaskets=new We(t,s,n),this.activeBaskets=new We(t,s,n,!0),this.activeOtherBaskets=new We(t,s,n,!0,!0),this.reviewBaskets=new We(t,s,n,!1,!0),this.occurrences="score"===n?new Je(t,s):null,this.templates={score:he,real:_e}}return Object(b.a)(e,[{key:"initial_load",value:function(e,t,s,n){var a=this;if(this.basket.getRules(t,s),this.submittedBaskets.getBaskets(this.weeks_old,(function(){return a.updateUsedRuleTemplates()})),this.activeBaskets.getBaskets(999),"score"===this.type){this.occurrences.getOccurrences(this.weeks_old,100)}e&&(this.activeOtherBaskets.getBaskets(999),this.reviewBaskets.getBaskets(999,n))}},{key:"updateUsedRuleTemplates",value:function(){var e=this.templates[this.type].used,t=new Set;this.submittedBaskets.baskets.forEach((function(s){console.log(s),s.rules.forEach((function(s){var n={text:s.text,operator:s.operator,cmp:s.cmp,points:s.points,cmp2:s.cmp2,operator2:s.operator2},a=Te()(n);t.has(a)||(t.add(a),n.id=ue()(),e.push(n))}))}))}}]),e}(),qe=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e,n){return Object(h.a)(this,s),t.call(this,e,n,"score",new Ne(e,n))}return s}(Ke),Ge=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e,n){return Object(h.a)(this,s),t.call(this,e,n,"real",new De(e,n))}return s}(Ke),He=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props,t=e.basket,s=e.id,a=e.onClick;return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:Object(n.jsx)(y.a,{variant:"outline",size:"sm",onClick:function(){return a(s)},children:Object(n.jsx)("div",{class:"text-left",children:t.timestamp})})}),Object(n.jsx)("td",{children:t.rules.length}),Object(n.jsx)("td",{children:Object(n.jsx)(L.a,{children:t.status})}),Object(n.jsx)("td",{children:t.valid_weeks})]})}}]),s}(r.a.Component),Ye=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={editIdx:-1},n}return Object(b.a)(s,[{key:"onClick",value:function(e){this.props.onClick(e,this.props.baskets[e])}},{key:"render",value:function(){var e=this,t=this.props.t;return Object(n.jsxs)(X.a,{striped:!0,bordered:!0,hover:!0,size:"sm",responsive:"lg",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"submitted at"})}),Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"#rules"})}),Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"status"})}),Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"#weeks valid"})})]})}),Object(n.jsx)("tbody",{children:"loading"===this.props.status?Object(n.jsx)(_.a,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}):this.props.baskets.map((function(s,a){return Object(n.jsx)(He,{t:t,basket:s,id:a,onClick:function(){return e.onClick(a)}})}))})]})}}]),s}(r.a.Component),Ze=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={message:n.props.neg_state.submittedBaskets.message,baskets:n.props.neg_state.submittedBaskets.baskets},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to baskets loaded"),this.props.neg_state.submittedBaskets.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.neg_state.submittedBaskets)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.submittedBaskets.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){this.setState({baskets:e.baskets}),console.log("Updated baskets: ",e.baskets.length)}},{key:"refresh",value:function(){var e=this;this.props.neg_state.submittedBaskets.getBaskets(this.props.neg_state.weeks_old,(function(t){return e.onSuccess(t)}),(function(t){return e.onError(t)}))}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onSuccess",value:function(e){this.setState({message:e.message})}},{key:"onClick",value:function(e,t){this.props.history.push("/negotiate_score/"+this.props.member+"/submitted_basket/"+t.basket_id+"/")}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.neg_state,r=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:r}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+r+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Score"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+r+"/submitted_baskets/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Submitted Baskets"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsxs)(y.a,{onClick:function(){return e.refresh()},block:!0,children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"Refresh"})]}),Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"Submitted reward / penalty negotiation baskets"}),":"]}),Object(n.jsx)(Ye,{t:s,baskets:a.submittedBaskets.baskets,allowClick:!0,onClick:function(t,s){return e.onClick(t,s)}})]})]})]})}}]),s}(r.a.Component),Qe=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={basketFound:!1,message1:n.props.neg_state.basket.message,message2:n.props.neg_state.submittedBaskets.message,basket_size:n.props.neg_state.basket.score_rules.length,rules:[]},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded1(t)})),this.onLoaded1(this.props.neg_state.basket),this.props.neg_state.submittedBaskets.subscribe_loaded(this,(function(t){return e.onLoaded2(t)})),this.onLoaded2(this.props.neg_state.submittedBaskets)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded1",value:function(e){this.setState({basket_size:e.score_rules.length,message1:this.props.neg_state.basket.message}),console.log("Updated bucket size: ",this.state.basket_size)}},{key:"onLoaded2",value:function(e){var t=this.props.basket_id;if(t in this.props.neg_state.submittedBaskets.basketIds){var s=this.props.neg_state.submittedBaskets.baskets[this.props.neg_state.submittedBaskets.basketIds[t]];this.setState({basketFound:!0,message2:this.props.neg_state.submittedBaskets.message,rules:s.rules})}else this.setState({basketFound:!1,message2:"Did not find basket in submitted baskets. Please hit reload."});console.log("Updated baskets: ",this.props.neg_state.submittedBaskets.baskets),console.log("Updated basketIds: ",this.props.neg_state.submittedBaskets.basketIds),console.log("Looking for basket: ",t)}},{key:"refresh1",value:function(){var e=this;this.props.neg_state.basket.getRules((function(t,s){return e.onSuccess1(t)}),(function(t,s){return e.onError1(t)}))}},{key:"refresh2",value:function(){var e=this;this.props.neg_state.submittedBaskets.getBaskets(this.props.neg_state.weeks_old,(function(t){return e.onSuccess2(t)}),(function(t){return e.onError2(t)}))}},{key:"onError1",value:function(e){this.setState({message:e.message})}},{key:"onSuccess1",value:function(e){this.setState({message:e.message})}},{key:"onError2",value:function(e){this.setState({message:e.message})}},{key:"onSuccess2",value:function(e){this.setState({message:e.message})}},{key:"onAddBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.addRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.score_rules.length}),this.props.history.push("/negotiate_score/"+this.props.member+"/basket")}},{key:"onReplaceBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.setRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.score_rules.length}),this.props.history.push("/negotiate_score/"+this.props.member+"/basket")}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member,r=t.id;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Score"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/submitted_baskets/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Submitted Baskets"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/submitted_basket/"+r+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Basket"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message1?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message1}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh1()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),""===this.state.message2?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message2}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh2()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(xe,{t:s,rules:this.state.rules}),Object(n.jsx)(y.a,{onClick:function(){return e.onAddBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Add to current negotiation rules"})}),Object(n.jsxs)(y.a,{onClick:function(){return e.onReplaceBasket()},block:!0,children:[Object(n.jsx)(L.a,{children:"Replace current negotiation rules"}),"(",this.state.basket_size,")"]})]})]})]})}}]),s}(r.a.Component),Xe=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={},n}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props.messages;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(D.LinkContainer,{to:"/home",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Home"})})}),Object(n.jsx)(D.LinkContainer,{to:"/inbox",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Inbox"})})})]}),Object(n.jsx)(K.a,{children:Object(n.jsxs)(X.a,{children:[Object(n.jsxs)("thead",{children:[Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"time"})}),Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"message"})})]}),Object(n.jsx)("tbody",{children:e.map((function(e){return Object(n.jsx)(D.LinkContainer,{to:e.getUrl(),children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:Object(n.jsx)(y.a,{variant:"outline",children:e.getTimestamp()})}),Object(n.jsx)("td",{children:Object(n.jsx)(y.a,{variant:"outline",children:e.getMessage()})})]})})}))})]})})]})}}]),s}(r.a.Component),$e=function(){function e(t,s,n,a,r){Object(h.a)(this,e),this.t=t,this.member=s,this.type=n,this.basket=a,this.parent=r}return Object(b.a)(e,[{key:"getUrl",value:function(){return"/negotiate_"+this.type+"/"+this.member+"/review_basket/"+this.basket.basket_id+"/"}},{key:"getTimestamp",value:function(){return this.basket.timestamp}},{key:"getMessage",value:function(){var e=this.t,t=this.member,s=this.type,n=this.basket,a="I"===t?this.parent:t,r=e("score"===s?"score rules":"implication rules");return a+e(" asked you to review ")+n.rules.length+" "+r}}]),e}(),et=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={basketFound:!1,message1:n.props.neg_state.basket.message,message2:n.props.neg_state.reviewBaskets.message,reviewMessage:"",basket_size:n.props.neg_state.basket.score_rules.length,rules:[],validWeeks:0},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded1(t)})),this.onLoaded1(this.props.neg_state.basket),this.props.neg_state.reviewBaskets.subscribe_loaded(this,(function(t){return e.onLoaded2(t)})),this.onLoaded2(this.props.neg_state.reviewBaskets)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded1",value:function(e){this.setState({basket_size:e.score_rules.length,message1:this.props.neg_state.basket.message}),console.log("Updated bucket size: ",this.state.basket_size)}},{key:"onLoaded2",value:function(e){var t=this.props.basket_id;if(t in this.props.neg_state.reviewBaskets.basketIds){var s=this.props.neg_state.reviewBaskets.baskets[this.props.neg_state.reviewBaskets.basketIds[t]];this.setState({basketFound:!0,message2:this.props.neg_state.reviewBaskets.message,rules:s.rules,validWeeks:s.valid_weeks})}else this.setState({basketFound:!1,message2:"Did not find basket in review baskets. Please hit reload."});console.log("Updated baskets: ",this.props.neg_state.reviewBaskets.baskets),console.log("Updated basketIds: ",this.props.neg_state.reviewBaskets.basketIds),console.log("Looking for basket: ",t)}},{key:"refresh1",value:function(){var e=this;this.props.neg_state.basket.getRules((function(t,s){return e.onSuccess1(t)}),(function(t,s){return e.onError1(t)}))}},{key:"refresh2",value:function(){var e=this;this.props.neg_state.reviewBaskets.getBaskets(this.props.neg_state.weeks_old,(function(t){return e.onSuccess2(t)}),(function(t){return e.onError2(t)}))}},{key:"onError1",value:function(e){this.setState({message:e.message})}},{key:"onSuccess1",value:function(e){this.setState({message:e.message})}},{key:"onError2",value:function(e){this.setState({message:e.message})}},{key:"onSuccess2",value:function(e){this.setState({message:e.message})}},{key:"gotoInbox",value:function(){this.props.onInboxUpdate(),this.props.history.push("/inbox")}},{key:"gotoBasket",value:function(){this.props.onInboxUpdate(),this.props.history.push("/negotiate_score/"+this.props.member+"/basket")}},{key:"onAcceptBasket",value:function(){var e=this;this.setState({reviewMessage:""});var t=this.props.neg_state.reviewBaskets;t.accept(this.props.basket_id,(function(){return e.gotoInbox()}),(function(){return e.setState({reviewMessage:t.message})}))}},{key:"onRejectBasket",value:function(){var e=this;this.setState({reviewMessage:""});var t=this.props.neg_state.reviewBaskets;t.reject(this.props.basket_id,(function(){return e.gotoInbox()}),(function(){return e.setState({reviewMessage:t.message})}))}},{key:"onRejectAndAddBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.addRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.score_rules.length,reviewMessage:""});var s=this.props.neg_state.reviewBaskets;s.reject(this.props.basket_id,(function(){return e.gotoBasket()}),(function(){return e.setState({reviewMessage:s.message})}))}},{key:"onRejectAndReplaceBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.setRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.score_rules.length,reviewMessage:""});var s=this.props.neg_state.reviewBaskets;s.reject(this.props.basket_id,(function(){return e.gotoBasket()}),(function(){return e.setState({reviewMessage:s.message})}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member,r=t.id;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Score"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/submitted_baskets/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Submitted Baskets"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_score/"+a+"/submitted_basket/"+r+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Basket"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message1?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[this.state.message1,Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh1()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),""===this.state.message2?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[this.state.message2,Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh2()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),""===this.state.reviewMessage?Object(n.jsx)(n.Fragment,{}):Object(n.jsx)(v.a,{variant:"warning",children:this.state.reviewMessage}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"The following reward / penalty rules shall be valid"})," ",this.state.validWeeks," ",Object(n.jsx)(L.a,{children:"weeks:"})]}),Object(n.jsx)(xe,{t:s,rules:this.state.rules}),Object(n.jsx)(y.a,{onClick:function(){return e.onAcceptBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Accept"})}),Object(n.jsx)(y.a,{onClick:function(){return e.onRejectBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Reject"})}),Object(n.jsx)(y.a,{onClick:function(){return e.onRejectAndAddBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Reject and add to current negotiation rules"})}),Object(n.jsxs)(y.a,{onClick:function(){return e.onRejectAndReplaceBasket()},block:!0,children:[Object(n.jsx)(L.a,{children:"Reject and replace current negotiation rules"}),"(",this.state.basket_size,")"]})]})]})]})}}]),s}(r.a.Component),tt=function(){function e(t){Object(h.a)(this,e),this.t=t,this.status="loading",this.message="",this.members=[],this.subscribers_loaded={},this.subscribers_change={}}return Object(b.a)(e,[{key:"subscribe_change",value:function(e,t){this.subscribers_change[e]=t}},{key:"unsubscribe_change",value:function(e){delete this.subscribers_change[e]}},{key:"subscribe_loaded",value:function(e,t){this.subscribers_loaded[e]=t}},{key:"unsubscribe_loaded",value:function(e){delete this.subscribers_loaded[e]}},{key:"_notify_subscribers_change",value:function(){console.log("Family members notifying change subscribers: ",this.type,Object.keys(this.subscribers_change).length);for(var e=0,t=Object.values(this.subscribers_change);e<t.length;e++){(0,t[e])(this)}}},{key:"_notify_subscribers_loaded",value:function(){console.log("Family members notifying status subscribers: ",this.type,Object.keys(this.subscribers_loaded).length);for(var e=0,t=Object.values(this.subscribers_loaded);e<t.length;e++){(0,t[e])(this)}}},{key:"getMembers",value:function(e,t){var s=this;F((function(n,a){return fetch(E.url+"/familymembers",{method:"GET",mode:"cors",headers:{Authorization:n}}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){s.members=t.members.Items,s.status="loaded",s.message="",console.log("FamilyMembers.getMembers",s.members),s._notify_subscribers_change(),s._notify_subscribers_loaded(),void 0!==e&&e(s,s.members)})).catch((function(e){console.log("FamilyMembers.getMembers error",e),s.status="error",s.message="Failed loading family members due to connection problems. Please hit reload.",void 0!==t&&t(s,e)}))}))}},{key:"addMember",value:function(e,t,s){var n=this,a=e.replace("@","-at-");console.log("New Member: "+a),F((function(e,r){return fetch(E.url+"/familymembers",{method:"POST",mode:"cors",headers:{Authorization:e,"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({member_uid:a})}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(e){n.members.push({member_uid:a,status:"pending"}),console.log("FamilyMembers.addMember",n.members),n._notify_subscribers_change(),t(n,a)})).catch((function(e){console.log("FamilyMembers.addMember error",e),s(n,e)}))}))}}]),e}(),st=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={basketFound:!1,message1:n.props.neg_state.basket.message,message2:n.props.neg_state.reviewBaskets.message,reviewMessage:"",basket_size:n.props.neg_state.basket.real_rules.length,rules:[],validWeeks:0},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded1(t)})),this.onLoaded1(this.props.neg_state.basket),this.props.neg_state.reviewBaskets.subscribe_loaded(this,(function(t){return e.onLoaded2(t)})),this.onLoaded2(this.props.neg_state.reviewBaskets)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded1",value:function(e){this.setState({basket_size:e.real_rules.length,message1:this.props.neg_state.basket.message}),console.log("Updated bucket size: ",this.state.basket_size)}},{key:"onLoaded2",value:function(e){var t=this.props.basket_id;if(t in this.props.neg_state.reviewBaskets.basketIds){var s=this.props.neg_state.reviewBaskets.baskets[this.props.neg_state.reviewBaskets.basketIds[t]];this.setState({basketFound:!0,message2:this.props.neg_state.reviewBaskets.message,rules:s.rules,validWeeks:s.valid_weeks})}else this.setState({basketFound:!1,message2:"Did not find basket in review baskets. Please hit reload."});console.log("Updated baskets: ",this.props.neg_state.reviewBaskets.baskets),console.log("Updated basketIds: ",this.props.neg_state.reviewBaskets.basketIds),console.log("Looking for basket: ",t)}},{key:"refresh1",value:function(){var e=this;this.props.neg_state.basket.getRules((function(t,s){return e.onSuccess1(t)}),(function(t,s){return e.onError1(t)}))}},{key:"refresh2",value:function(){var e=this;this.props.neg_state.reviewBaskets.getBaskets(this.props.neg_state.weeks_old,(function(t){return e.onSuccess2(t)}),(function(t){return e.onError2(t)}))}},{key:"onError1",value:function(e){this.setState({message:e.message})}},{key:"onSuccess1",value:function(e){this.setState({message:e.message})}},{key:"onError2",value:function(e){this.setState({message:e.message})}},{key:"onSuccess2",value:function(e){this.setState({message:e.message})}},{key:"gotoInbox",value:function(){this.props.onInboxUpdate(),this.props.history.push("/inbox")}},{key:"gotoBasket",value:function(){this.props.onInboxUpdate(),this.props.history.push("/negotiate_real/"+this.props.member+"/basket")}},{key:"onAcceptBasket",value:function(){var e=this;this.setState({reviewMessage:""});var t=this.props.neg_state.reviewBaskets;t.accept(this.props.basket_id,(function(){return e.gotoInbox()}),(function(){return e.setState({reviewMessage:t.message})}))}},{key:"onRejectBasket",value:function(){var e=this;this.setState({reviewMessage:""});var t=this.props.neg_state.reviewBaskets;t.reject(this.props.basket_id,(function(){return e.gotoInbox()}),(function(){return e.setState({reviewMessage:t.message})}))}},{key:"onRejectAndAddBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.addRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.real_rules.length,reviewMessage:""});var s=this.props.neg_state.reviewBaskets;s.reject(this.props.basket_id,(function(){return e.gotoBasket()}),(function(){return e.setState({reviewMessage:s.message})}))}},{key:"onRejectAndReplaceBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.setRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.real_rules.length,reviewMessage:""});var s=this.props.neg_state.reviewBaskets;s.reject(this.props.basket_id,(function(){return e.gotoBasket()}),(function(){return e.setState({reviewMessage:s.message})}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member,r=t.id;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Real"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/submitted_baskets/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Submitted Baskets"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/submitted_basket/"+r+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Basket"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message1?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[this.state.message1,Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh1()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),""===this.state.message2?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[this.state.message2,Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh2()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),""===this.state.reviewMessage?Object(n.jsx)(n.Fragment,{}):Object(n.jsx)(v.a,{variant:"warning",children:this.state.reviewMessage}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"The following real effect rules shall be valid"})," ",this.state.validWeeks," ",Object(n.jsx)(L.a,{children:"weeks:"})]}),Object(n.jsx)(Fe,{t:s,rules:this.state.rules}),Object(n.jsx)(y.a,{onClick:function(){return e.onAcceptBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Accept"})}),Object(n.jsx)(y.a,{onClick:function(){return e.onRejectBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Reject"})}),Object(n.jsx)(y.a,{onClick:function(){return e.onRejectAndAddBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Reject and add to current negotiation rules"})}),Object(n.jsxs)(y.a,{onClick:function(){return e.onRejectAndReplaceBasket()},block:!0,children:[Object(n.jsx)(L.a,{children:"Reject and replace current negotiation rules"}),"(",this.state.basket_size,")"]})]})]})]})}}]),s}(r.a.Component),nt=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={basketFound:!1,message1:n.props.neg_state.basket.message,message2:n.props.neg_state.submittedBaskets.message,basket_size:n.props.neg_state.basket.real_rules.length,rules:[]},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.props.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded1(t)})),this.onLoaded1(this.props.neg_state.basket),this.props.neg_state.submittedBaskets.subscribe_loaded(this,(function(t){return e.onLoaded2(t)})),this.onLoaded2(this.props.neg_state.submittedBaskets)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded1",value:function(e){this.setState({basket_size:e.real_rules.length,message1:this.props.neg_state.basket.message}),console.log("Updated bucket size: ",this.state.basket_size)}},{key:"onLoaded2",value:function(e){var t=this.props.basket_id;if(t in this.props.neg_state.submittedBaskets.basketIds){var s=this.props.neg_state.submittedBaskets.baskets[this.props.neg_state.submittedBaskets.basketIds[t]];this.setState({basketFound:!0,message2:this.props.neg_state.submittedBaskets.message,rules:s.rules})}else this.setState({basketFound:!1,message2:"Did not find basket in submitted baskets. Please hit reload."});console.log("Updated baskets: ",this.props.neg_state.submittedBaskets.baskets),console.log("Updated basketIds: ",this.props.neg_state.submittedBaskets.basketIds),console.log("Looking for basket: ",t)}},{key:"refresh1",value:function(){var e=this;this.props.neg_state.basket.getRules((function(t,s){return e.onSuccess1(t)}),(function(t,s){return e.onError1(t)}))}},{key:"refresh2",value:function(){var e=this;this.props.neg_state.submittedBaskets.getBaskets(this.props.neg_state.weeks_old,(function(t){return e.onSuccess2(t)}),(function(t){return e.onError2(t)}))}},{key:"onError1",value:function(e){this.setState({message:e.message})}},{key:"onSuccess1",value:function(e){this.setState({message:e.message})}},{key:"onError2",value:function(e){this.setState({message:e.message})}},{key:"onSuccess2",value:function(e){this.setState({message:e.message})}},{key:"onAddBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.addRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.real_rules.length}),this.props.history.push("/negotiate_real/"+this.props.member+"/basket")}},{key:"onReplaceBasket",value:function(){var e=this,t=this.state.rules.map((function(e){var t=Object(o.a)({},e);return t.id=ue()(),t}));this.props.neg_state.basket.setRules(t,(function(t,s,n){return e.onError1(t)})),this.setState({basket_size:this.props.neg_state.basket.real_rules.length}),this.props.history.push("/negotiate_real/"+this.props.member+"/basket")}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member,r=t.id;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Real"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/submitted_baskets/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Submitted Baskets"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/submitted_basket/"+r+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Basket"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message1?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message1}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh1()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),""===this.state.message2?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message2}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh2()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsx)(Fe,{t:s,rules:this.state.rules}),Object(n.jsx)(y.a,{onClick:function(){return e.onAddBasket()},block:!0,children:Object(n.jsx)(L.a,{children:"Add to current negotiation rules"})}),Object(n.jsxs)(y.a,{onClick:function(){return e.onReplaceBasket()},block:!0,children:[Object(n.jsx)(L.a,{children:"Replace current negotiation rules"}),"(",this.state.basket_size,")"]})]})]})]})}}]),s}(r.a.Component),at=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={message:n.props.neg_state.submittedBaskets.message,baskets:n.props.neg_state.submittedBaskets.baskets},console.log("Constructor / current size=",n.state.basket_size),n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to baskets loaded"),this.props.neg_state.submittedBaskets.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.props.neg_state.submittedBaskets)}},{key:"componentWillUnmount",value:function(){this.props.neg_state.submittedBaskets.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){this.setState({baskets:e.baskets}),console.log("Updated baskets: ",e.baskets.length)}},{key:"refresh",value:function(){var e=this;this.props.neg_state.submittedBaskets.getBaskets(this.props.neg_state.weeks_old,(function(t){return e.onSuccess(t)}),(function(t){return e.onError(t)}))}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onSuccess",value:function(e){this.setState({message:e.message})}},{key:"onClick",value:function(e,t){this.props.history.push("/negotiate_real/"+this.props.member+"/submitted_basket/"+t.basket_id+"/")}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.neg_state,r=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:r}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+r+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Real"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+r+"/submitted_baskets/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Submitted Baskets"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("div",{className:"nav-buttons",children:[Object(n.jsxs)(y.a,{onClick:function(){return e.refresh()},block:!0,children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"Refresh"})]}),Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"Submitted real effect negotiation baskets"}),":"]}),Object(n.jsx)(Ye,{t:s,baskets:a.submittedBaskets.baskets,allowClick:!0,onClick:function(t,s){return e.onClick(t,s)}})]})]})]})}}]),s}(r.a.Component),rt=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).changeValidWeeks=n.changeValidWeeks.bind(Object(A.a)(n)),n.state={real:0,neg_state:n.props.neg_state,message:"",basket_status:n.props.neg_state.basket.status,basket_size:n.props.neg_state.basket.real_rules.length,basket_rules:[],validWeeks:52},n}return Object(b.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("Subscribed to basket loaded / current size=",this.state.basket_size),this.state.neg_state.basket.subscribe_loaded(this,(function(t){return e.onLoaded(t)})),this.onLoaded(this.state.neg_state.basket)}},{key:"componentWillUnmount",value:function(){this.state.neg_state.basket.unsubscribe_change(this)}},{key:"onLoaded",value:function(e){console.log("Updated bucket size: ",this.state.neg_state.basket.real_rules.length,this.state.neg_state.basket.status),this.setState({basket_status:e.status,basket_size:e.real_rules.length,basket_rules:e.real_rules,message:e.message})}},{key:"onError",value:function(e){this.setState({message:e.message})}},{key:"onSuccess",value:function(e){this.setState({message:e.message})}},{key:"onSubmitSuccess",value:function(e){this.setState({basket_status:this.state.neg_state.basket.status,basket_rules:this.state.neg_state.basket.real_rules,basket_size:this.state.neg_state.basket.real_rules.length,message:this.state.neg_state.basket.message}),this.props.history.push("/negotiate_real/"+this.props.member+"/submitted_baskets")}},{key:"onEdit",value:function(e,t){var s=this;this.state.neg_state.basket.updateRule(t,(function(e,t,n){return s.onError(e,t,n)}))}},{key:"onDelete",value:function(e,t){var s=this;this.state.neg_state.basket.deleteRule(t,(function(e,t,n){return s.onError(e,t,n)})),this.setState({basket_status:this.state.neg_state.basket.status,basket_rules:this.state.neg_state.basket.real_rules,basket_size:this.state.neg_state.basket.real_rules.length,message:this.state.neg_state.basket.message})}},{key:"onSubmit",value:function(){var e=this;this.state.neg_state.basket.submit(this.state.validWeeks,(function(t){return e.onSubmitSuccess(t)}),(function(t){return e.onError(t)}))}},{key:"changeValidWeeks",value:function(e){this.setState({validWeeks:e.target.value})}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/",children:Object(n.jsx)(T.a.Item,{children:Object(n.jsx)(L.a,{children:"Negotiate Real"})})}),Object(n.jsx)(D.LinkContainer,{to:"/negotiate_real/"+a+"/basket",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Basket"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.state.neg_state.basket.getRules((function(t,s){return e.onSuccess(t)}),(function(t,s){return e.onError(t)}))},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),"loading"===this.state.neg_state.basket.state?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D.Spinner,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}),Object(n.jsx)(y.a,{size:"sm",onClick:function(){return e.state.neg_state.basket.getRules()},children:Object(n.jsx)(w.a,{})})]}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("h5",{children:[this.state.basket_size," ",Object(n.jsx)(L.a,{children:"entries in real effect negotiation basket"}),":"]}),Object(n.jsx)(Fe,{t:s,rules:this.state.basket_rules,status:this.state.basket_status,onChange:function(t,s){return e.onEdit(t,s)},onDelete:function(t,s){return e.onDelete(t,s)},allowChange:!0}),Object(n.jsx)("h5",{children:Object(n.jsx)(L.a,{children:"These rules shall be valid for:"})}),Object(n.jsxs)($.a,{className:"mb-3",children:[Object(n.jsx)(N.a,{placeholder:s("recommended are 12 months since frequent renegotiation keeps rules effective"),"aria-label":"validity_weeks","aria-describedby":"basic-addon1",value:this.state.validWeeks,onChange:this.changeValidWeeks}),Object(n.jsx)($.a.Append,{children:Object(n.jsx)($.a.Text,{id:"basic-addon2",children:Object(n.jsx)(L.a,{children:"weeks"})})})]}),Object(n.jsx)(y.a,{onClick:function(){return e.onSubmit()},block:!0,children:Object(n.jsx)(L.a,{children:"Submit"})})]})]})]})}}]),s}(r.a.Component),it=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e,n){var a;return Object(h.a)(this,s),(a=t.call(this,e,n)).score=1e3,a}return Object(b.a)(s,[{key:"getScore",value:function(e,t){var s=this;F((function(n,a){return fetch(E.url+"/score?member_uid="+s.member,{method:"GET",mode:"cors",headers:{Authorization:n}}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(t){s.score=t.score,console.log("Score.getScore: ",s.score),s.onLoaded(),void 0!==e&&e(s,s.score)})).catch((function(e){console.log("Score.getScore error",e),s.onError("Failed loading score due to connection problems. Please hit reload."),void 0!==t&&t(s,e)}))}))}},{key:"setScore",value:function(e){this.score=e,console.log("Score.setScore: ",this.score),this.onChanged()}}]),s}(Ve),ct=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"render",value:function(){var e=this.props.occurrence,t=e.rule,s=null==t.operator,a=new Date;a.setTime(e.timestamp_millis);var r=a.toISOString();return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{style:{"min-width":"3em",textAlign:"right"},children:e.score}),Object(n.jsx)("td",{style:{"min-width":"5em"},children:r}),Object(n.jsx)("td",{style:{"min-width":"10em"},colSpan:s?3:1,children:Object(n.jsx)(L.a,{children:t.text})}),s?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{style:{"min-width":"2em"},children:t.operator}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:t.cmp})})]}),Object(n.jsx)("td",{style:{"min-width":"2em",textAlign:"right"},children:t.points}),Object(n.jsx)("td",{}),Object(n.jsx)("td",{style:{"min-width":"2em"},children:Object(n.jsx)(L.a,{children:e.status})})]})}}]),s}(r.a.Component),ot=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(b.a)(s,[{key:"onDelete",value:function(e){}},{key:"onAccept",value:function(e){}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.occurrences;return Object(n.jsxs)(X.a,{striped:!0,bordered:!0,hover:!0,size:"sm",responsive:"lg",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"score"})}),Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"time"})}),Object(n.jsx)("th",{colSpan:"3",children:Object(n.jsx)(L.a,{children:"rule"})}),Object(n.jsx)("th",{children:Object(n.jsx)(L.a,{children:"points"})}),Object(n.jsx)("th",{}),Object(n.jsx)("th",{children:"status"})]})}),Object(n.jsx)("tbody",{children:"loading"===this.props.status?Object(n.jsx)(_.a,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}):a.map((function(t,a){return Object(n.jsx)(ct,{t:s,occurrence:t,id:a,onDelete:function(){return e.onDelete(a)}})}))})]})}}]),s}(r.a.Component),lt=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={message:"",occurrences:[]},n}return Object(b.a)(s,[{key:"updateOccurrences",value:function(){console.log("Updated occurrences: ",this.props.neg_state.occurrences.occurrences.length,this.props.neg_state.occurrences.status),this.setState({occurrences:this.props.neg_state.occurrences.occurrences,message:this.props.neg_state.occurrences.message})}},{key:"componentDidMount",value:function(){console.log("Subscribed to occurrences changed",this.props.neg_state.occurrences.occurrences.length),this.props.neg_state.occurrences.subscribe_change(this),this.updateOccurrences()}},{key:"componentWillUnmount",value:function(){this.props.neg_state.occurrences.unsubscribe_change(this)}},{key:"onOccurrenceError",value:function(){this.setState({message:this.props.neg_state.occurrences.message})}},{key:"refresh",value:function(){var e=this;this.props.neg_state.occurrences.getOccurrences(this.props.neg_state.weeks_old,100,null,(function(){}),(function(){return e.onOccurrenceError()}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.member;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(T.a,{children:[Object(n.jsx)(se,{t:s,member:a}),Object(n.jsx)(D.LinkContainer,{to:"/update_score/"+a+"/",children:Object(n.jsx)(T.a.Item,{active:!0,children:Object(n.jsx)(L.a,{children:"Update Score"})})})]}),Object(n.jsxs)(K.a,{children:[""===this.state.message?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(v.a,{variant:"warning",children:[Object(n.jsx)(L.a,{children:this.state.message}),Object(n.jsxs)(y.a,{variant:"outline",size:"sm",onClick:function(){return e.refresh()},children:[Object(n.jsx)(w.a,{})," ",Object(n.jsx)(L.a,{children:"refresh"})]})]}),Object(n.jsxs)("h5",{children:[Object(n.jsx)(L.a,{children:"Occurrences that drive current score"}),":"]}),Object(n.jsx)(ot,{t:s,occurrences:this.state.occurrences})]})]})}}]),s}(r.a.Component);function ut(e,t,s){return s in e||(e[s]=new it(t,s),e[s].getScore()),e[s]}function ht(e){var t=Object(m.m)().member,s=Object(m.k)(),a=ut(e.scores,e.t,t);return Object(n.jsx)(ne,{t:e.t,score:a,member:t,history:s})}function bt(e,t,s,n,a,r){s in e||(e[s]=new qe(t,s),e[s].initial_load(n,a,a,r))}function dt(e,t,s,n,a,r){s in e||(e[s]=new Ge(t,s),e[s].initial_load(n,a,a,r))}function jt(e){var t=Object(m.m)().member,s=Object(m.k)();return bt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(me,{t:e.t,neg_state:e.neg_state[t],member:t,history:s})}function mt(e){var t=Object(m.m)().member,s=Object(m.k)();return bt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(Ue,{t:e.t,neg_state:e.neg_state[t],member:t,history:s})}function pt(e){var t=Object(m.m)(),s=t.member,a=t.template,r=Object(m.k)();return bt(e.neg_state,e.t,s,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(ve,{t:e.t,neg_state:e.neg_state[s],member:s,template:a,history:r})}function gt(e){var t=Object(m.m)().member,s=Object(m.k)();return bt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(Ze,{t:e.t,neg_state:e.neg_state[t],member:t,history:s})}function Ot(e){var t=Object(m.m)(),s=t.member,a=t.basket,r=Object(m.k)();return bt(e.neg_state,e.t,s,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(Qe,{t:e.t,neg_state:e.neg_state[s],basket_id:a,member:s,history:r})}function ft(e){var t=Object(m.m)().member,s=Object(m.k)();return dt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(Ie,{t:e.t,neg_state:e.neg_state[t],member:t,history:s})}function kt(e){var t=Object(m.m)().member,s=Object(m.k)();return dt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(rt,{t:e.t,neg_state:e.neg_state[t],member:t,history:s})}function xt(e){var t=Object(m.m)(),s=t.member,a=t.template,r=Object(m.k)();return dt(e.neg_state,e.t,s,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(Ee,{t:e.t,neg_state:e.neg_state[s],member:s,template:a,history:r})}function vt(e){var t=Object(m.m)().member,s=Object(m.k)();return dt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(at,{t:e.t,neg_state:e.neg_state[t],member:t,history:s})}function _t(e){var t=Object(m.m)(),s=t.member,a=t.basket,r=Object(m.k)();return dt(e.neg_state,e.t,s,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(nt,{t:e.t,neg_state:e.neg_state[s],basket_id:a,member:s,history:r})}function yt(e){var t=Object(m.m)().member,s=Object(m.k)();bt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate);var a=ut(e.scores,e.t,t);return Object(n.jsx)(Le,{t:e.t,score:a,neg_state:e.neg_state[t],member:t,history:s})}function St(e){var t=Object(m.m)().member,s=Object(m.k)();bt(e.neg_state,e.t,t,e.onRefresh,e.onInboxUpdate);var a=ut(e.scores,e.t,t);return Object(n.jsx)(lt,{t:e.t,score:a,neg_state:e.neg_state[t],member:t,history:s})}function wt(e){var t=Object(m.m)(),s=t.member,a=t.basket,r=Object(m.k)();return bt(e.neg_state,e.t,s,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(et,{t:e.t,neg_state:e.neg_state[s],basket_id:a,member:s,history:r,onInboxUpdate:e.onInboxUpdate})}function Ct(e){var t=Object(m.m)(),s=t.member,a=t.basket,r=Object(m.k)();return dt(e.neg_state,e.t,s,e.onRefresh,e.onInboxUpdate),Object(n.jsx)(st,{t:e.t,neg_state:e.neg_state[s],basket_id:a,member:s,history:r,onInboxUpdate:e.onInboxUpdate})}var It=function(e){Object(d.a)(s,e);var t=Object(j.a)(s);function s(e){var n;return Object(h.a)(this,s),(n=t.call(this,e)).state={connectedTo:"",scores:{myself:new it(n.props.t,"myself"),I:new it(n.props.t,"I")},memberStatus:"unknown",familyMembers:new tt(n.props.t),negotiationStateScore:{myself:new qe(n.props.t,"myself"),I:new qe(n.props.t,"I")},negotiationStateReal:{myself:new Ge(n.props.t,"myself"),I:new Ge(n.props.t,"I")},inboxMessages:[]},n}return Object(b.a)(s,[{key:"reset_negotiation_state",value:function(){var e=this;this.state.familyMembers.getMembers((function(){return e.updateMembers()}),(function(){return e.forceUpdate()}));var t={negotiationStateScore:{myself:new qe(this.props.t,"myself"),I:new qe(this.props.t,"I")},negotiationStateReal:{myself:new Ge(this.props.t,"myself"),I:new Ge(this.props.t,"I")},scores:{myself:new it(this.props.t,"myself"),I:new it(this.props.t,"I")}},s=!0;t.scores.myself.getScore(),t.scores.I.getScore(),t.negotiationStateScore.myself.initial_load(s,(function(){return e.forceUpdate()}),(function(){return e.forceUpdate()}),(function(){return e.updateInbox()})),t.negotiationStateScore.I.initial_load(s,(function(){return e.forceUpdate()}),(function(){return e.forceUpdate()}),(function(){return e.updateInbox()})),t.negotiationStateReal.myself.initial_load(s,(function(){return e.forceUpdate()}),(function(){return e.forceUpdate()}),(function(){return e.updateInbox()})),t.negotiationStateReal.I.initial_load(s,(function(){return e.forceUpdate()}),(function(){return e.forceUpdate()}),(function(){return e.updateInbox()})),this.setState(t)}},{key:"updateMembers",value:function(){var e,t=this,s=this.props.t,n=Object(u.a)(this.state.familyMembers.members);try{for(n.s();!(e=n.n()).done;){var a=e.value,r="accepted"===a.status||"deleting"===a.status;ut(this.state.scores,s,a.member_uid),bt(this.state.negotiationStateScore,s,a.member_uid,r,(function(){return t.forceUpdate()}),(function(){return t.updateInbox()})),dt(this.state.negotiationStateReal,s,a.member_uid,r,(function(){return t.forceUpdate()}),(function(){return t.updateInbox()}))}}catch(i){n.e(i)}finally{n.f()}}},{key:"componentDidMount",value:function(){this.signinChange()}},{key:"signinChange",value:function(){this.reset_negotiation_state(),this.refresh(null),this.forceUpdate()}},{key:"updateInbox",value:function(){for(var e=this.props.t,t=[],s=0,n=Object.entries(this.state.negotiationStateScore);s<n.length;s++){var a,r=Object(l.a)(n[s],2),i=r[0],c=r[1],o=Object(u.a)(c.reviewBaskets.baskets);try{for(o.s();!(a=o.n()).done;){var h=a.value;t.push(new $e(e,i,"score",h,c.reviewBaskets.parent))}}catch(k){o.e(k)}finally{o.f()}}for(var b=0,d=Object.entries(this.state.negotiationStateReal);b<d.length;b++){var j,m=Object(l.a)(d[b],2),p=m[0],g=m[1],O=Object(u.a)(g.reviewBaskets.baskets);try{for(O.s();!(j=O.n()).done;){var f=j.value;t.push(new $e(e,p,"real",f,g.reviewBaskets.parent))}}catch(k){O.e(k)}finally{O.f()}}t.sort((function(e,t){return e.getTimestamp()>t.getTimestamp()?1:e.getTimestamp()<t.getTimestamp()?-1:0})),this.setState({inboxMessages:t})}},{key:"refresh",value:function(e){var t=this;F((function(e,s){return fetch(E.url+"/familymember?member_uid="+s,{method:"GET",mode:"cors",headers:{Authorization:e}}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response status: "+e.status)})).then((function(e){var s="",n="";0===e.members.Items.length?(s="main",n=""):(s=e.members.Items[0].status,n=e.members.Items[0].parent_uid),t.setState({memberStatus:s,connectedTo:n}),console.log(t.state.memberStatus)})).catch((function(e){t.setState({memberStatus:"unknown",connectedTo:""}),console.log(e)}))}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.t,a=t.i18n,r=this.state,i=r.negotiationStateScore,c=r.negotiationStateReal,l=r.scores,u=function(e){a.changeLanguage(e)};return Object(n.jsx)(p.BrowserRouter,{basename:"",children:Object(n.jsxs)(g.a,{className:"app",children:[Object(n.jsxs)(O.a,{bg:"light",expand:"lg",children:[Object(n.jsx)(O.a.Brand,{href:"",children:"Game your Life"}),Object(n.jsxs)(f.a,{title:"Lang",id:"basic-nav-dropdown",children:[Object(n.jsx)(f.a.Item,{onClick:function(){return u("en")},children:"en"}),Object(n.jsx)(f.a.Item,{onClick:function(){return u("de")},children:"de"})]}),0===this.state.inboxMessages.length?Object(n.jsx)(n.Fragment,{}):Object(n.jsxs)(p.Link,{to:"/inbox",children:[Object(n.jsx)(S.a,{}),Object(n.jsx)(k.a,{children:this.state.inboxMessages.length})]}),Object(n.jsx)(O.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(n.jsx)(O.a.Collapse,{id:"login_signup",children:Object(n.jsxs)(x.a,{className:"ml-auto",children:[Object(n.jsxs)(x.a.Item,{children:[" ",B()," "]}),Object(n.jsx)(x.a.Link,{as:p.Link,to:"/introduction",children:Object(n.jsx)(L.a,{children:"Intro"})}),Object(n.jsx)(x.a.Link,{as:p.Link,to:"/sign-in",children:Object(n.jsx)(L.a,{children:"Sign in"})}),Object(n.jsx)(x.a.Link,{as:p.Link,to:"/sign-up",children:Object(n.jsx)(L.a,{children:"Sign up"})}),Object(n.jsx)(x.a.Link,{as:p.Link,to:"/sign-out",children:Object(n.jsx)(L.a,{children:"Sign out"})}),Object(n.jsx)(x.a.Link,{href:"https://github.com/game-your-life/feedback/issues",children:Object(n.jsx)(L.a,{children:"Give feedback"})})]})})]}),Object(n.jsx)(v.a,{variant:"warning",children:Object(n.jsxs)(L.a,{i18nKey:"beta.notice",children:["This is a Beta version. Please excuse any defects. I would appreciate any ",Object(n.jsx)("a",{href:"https://github.com/game-your-life/feedback/issues",children:"feedback"}),"!"]})}),R()?"unknown"===this.state.memberStatus?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(_.a,{animation:"border",role:"status",children:Object(n.jsxs)("span",{className:"sr-only",children:[Object(n.jsx)(L.a,{children:"Loading"}),"..."]})}),Object(n.jsx)(y.a,{size:"sm",onClick:function(){return e.refresh()},children:Object(n.jsx)(w.a,{})})]}):"pending"===this.state.memberStatus?Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(ie,{t:s,connectedTo:this.state.connectedTo,onStatusChange:function(t){e.refresh(null),e.forceUpdate()}})}):"deleting"===this.state.memberStatus?Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(ce,{t:s,connectedTo:this.state.connectedTo,onStatusChange:function(t){e.refresh(null),e.forceUpdate()}})}):Object(n.jsxs)(m.g,{children:[Object(n.jsx)(m.d,{exact:!0,path:"/",children:Object(n.jsx)(m.c,{to:"/home"})}),Object(n.jsx)(m.d,{path:"/home",children:Object(n.jsx)(Q,{t:s,scores:l,connectedTo:"accepted"===this.state.memberStatus?this.state.connectedTo:""})}),Object(n.jsx)(m.d,{path:"/family",children:Object(n.jsx)(te,{t:s,familyMembers:this.state.familyMembers})}),Object(n.jsx)(m.d,{path:"/sign-in",render:function(t){return Object(n.jsx)(W,Object(o.a)(Object(o.a)({},t),{},{t:s,onSigninSuccess:function(){return e.forceUpdate()}}))}}),Object(n.jsx)(m.d,{path:"/sign-up",children:Object(n.jsx)(V,{t:s})}),Object(n.jsx)(m.d,{path:"/sign-out",render:function(t){return Object(n.jsx)(J,Object(o.a)(Object(o.a)({},t),{},{t:s,onSignout:function(){return e.forceUpdate()}}))}}),Object(n.jsx)(m.d,{path:"/introduction",children:Object(n.jsx)(G,{t:s})}),Object(n.jsx)(m.d,{path:"/privacy",children:Object(n.jsx)(H,{t:s})}),Object(n.jsx)(m.d,{path:"/inbox",children:Object(n.jsx)(Xe,{t:s,messages:this.state.inboxMessages})}),Object(n.jsx)(m.d,{path:"/game/:member",children:Object(n.jsx)(ht,{t:s,scores:l})}),Object(n.jsx)(m.d,{exact:!0,path:"/negotiate_score/:member",children:Object(n.jsx)(jt,{t:s,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_score/:member/templates/:template",children:Object(n.jsx)(pt,{t:s,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_score/:member/basket",children:Object(n.jsx)(mt,{t:s,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_score/:member/submitted_baskets",children:Object(n.jsx)(gt,{t:s,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_score/:member/submitted_basket/:basket",children:Object(n.jsx)(Ot,{t:s,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{exact:!0,path:"/negotiate_real/:member",children:Object(n.jsx)(ft,{t:s,neg_state:c,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_real/:member/templates/:template",children:Object(n.jsx)(xt,{t:s,neg_state:c,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_real/:member/basket",children:Object(n.jsx)(kt,{t:s,neg_state:c,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_real/:member/submitted_baskets",children:Object(n.jsx)(vt,{t:s,neg_state:c,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_real/:member/submitted_basket/:basket",children:Object(n.jsx)(_t,{t:s,neg_state:c,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/update_score/:member",children:Object(n.jsx)(yt,{t:s,scores:l,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/score_detail/:member",children:Object(n.jsx)(St,{t:s,scores:l,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_score/:member/review_basket/:basket",children:Object(n.jsx)(wt,{t:s,neg_state:i,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})}),Object(n.jsx)(m.d,{path:"/negotiate_real/:member/review_basket/:basket",children:Object(n.jsx)(Ct,{t:s,neg_state:c,onRefresh:function(){return e.forceUpdate},onInboxUpdate:function(){return e.updateInbox()}})})]}):Object(n.jsxs)(m.g,{children:[Object(n.jsx)(m.d,{exact:!0,path:"/",children:Object(n.jsx)(G,{t:s})}),Object(n.jsx)(m.d,{path:"/sign-in",render:function(t){return Object(n.jsx)(W,Object(o.a)(Object(o.a)({},t),{},{t:s,onSigninSuccess:function(){e.refresh(null),e.forceUpdate()}}))}}),Object(n.jsx)(m.d,{path:"/sign-up",children:Object(n.jsx)(V,{t:s})}),Object(n.jsx)(m.d,{path:"/sign-out",render:function(t){return Object(n.jsx)(J,Object(o.a)(Object(o.a)({},t),{},{t:s,onSignout:function(){e.refresh(null),e.forceUpdate()}}))}}),Object(n.jsx)(m.d,{path:"/introduction",children:Object(n.jsx)(m.c,{to:"/"})}),Object(n.jsx)(m.d,{path:"/privacy",children:Object(n.jsx)(H,{t:s})})]})]})})}}]),s}(r.a.Component);function zt(){var e=Object(U.a)(),t=e.t,s=e.i18n;return Object(n.jsx)(It,{t:t,i18n:s})}var Rt=function(){return Object(n.jsx)(a.Suspense,{fallback:"loading",children:Object(n.jsx)(zt,{})})},Bt=(s(320),s(199)),Ft=s(201),Et=s(48),Lt=s(131);Lt.a.use(Bt.a).use(Ft.a).use(Et.e).init({fallbackLng:"en",debug:!0,interpolation:{escapeValue:!1},backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"}});Lt.a;c.a.render(Object(n.jsx)(Rt,{}),document.getElementById("root"))}},[[321,1,2]]]);